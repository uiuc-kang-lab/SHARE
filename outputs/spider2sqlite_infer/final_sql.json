{
    "0": "WITH daily_sales AS (\n  SELECT\n    DATE(o.order_purchase_timestamp) AS sale_date,\n    SUM(oi.price) AS sales\n  FROM olist_orders AS o\n  INNER JOIN olist_order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE DATE(o.order_purchase_timestamp) BETWEEN DATE('2017-01-01') AND DATE('2018-08-29')\n  GROUP BY DATE(o.order_purchase_timestamp)\n),\npredicted_sales AS (\n  -- Simple linear regression: sales = a + b * day_index\n  -- day_index is days since 2017-01-01\n  SELECT\n    DATE('2018-12-05') AS sale_date,\n    (a + b * (julianday('2018-12-05') - julianday('2017-01-01'))) AS pred_sales\n  FROM (\n    SELECT\n      (avg_y - b * avg_x) AS a,\n      b\n    FROM (\n      SELECT\n        AVG(x) AS avg_x,\n        AVG(y) AS avg_y,\n        SUM((x - AVG(x)) * (y - AVG(y))) / NULLIF(SUM((x - AVG(x)) * (x - AVG(x))), 0) AS b\n      FROM (\n        SELECT\n          (julianday(sale_date) - julianday('2017-01-01')) AS x,\n          sales AS y\n        FROM daily_sales\n      )\n    )\n  )\n  UNION ALL\n  SELECT\n    DATE('2018-12-06'),\n    (a + b * (julianday('2018-12-06') - julianday('2017-01-01')))\n  FROM (\n    SELECT\n      (avg_y - b * avg_x) AS a,\n      b\n    FROM (\n      SELECT\n        AVG(x) AS avg_x,\n        AVG(y) AS avg_y,\n        SUM((x - AVG(x)) * (y - AVG(y))) / NULLIF(SUM((x - AVG(x)) * (x - AVG(x))), 0) AS b\n      FROM (\n        SELECT\n          (julianday(sale_date) - julianday('2017-01-01')) AS x,\n          sales AS y\n        FROM daily_sales\n      )\n    )\n  )\n  UNION ALL\n  SELECT\n    DATE('2018-12-07'),\n    (a + b * (julianday('2018-12-07') - julianday('2017-01-01')))\n  FROM (\n    SELECT\n      (avg_y - b * avg_x) AS a,\n      b\n    FROM (\n      SELECT\n        AVG(x) AS avg_x,\n        AVG(y) AS avg_y,\n        SUM((x - AVG(x)) * (y - AVG(y))) / NULLIF(SUM((x - AVG(x)) * (x - AVG(x))), 0) AS b\n      FROM (\n        SELECT\n          (julianday(sale_date) - julianday('2017-01-01')) AS x,\n          sales AS y\n        FROM daily_sales\n      )\n    )\n  )\n  UNION ALL\n  SELECT\n    DATE('2018-12-08'),\n    (a + b * (julianday('2018-12-08') - julianday('2017-01-01')))\n  FROM (\n    SELECT\n      (avg_y - b * avg_x) AS a,\n      b\n    FROM (\n      SELECT\n        AVG(x) AS avg_x,\n        AVG(y) AS avg_y,\n        SUM((x - AVG(x)) * (y - AVG(y))) / NULLIF(SUM((x - AVG(x)) * (x - AVG(x))), 0) AS b\n      FROM (\n        SELECT\n          (julianday(sale_date) - julianday('2017-01-01')) AS x,\n          sales AS y\n        FROM daily_sales\n      )\n    )\n  )\n),\nmoving_avg_5 AS (\n  -- 5-day symmetric moving average over the 4 predicted days:\n  -- average of [t-2, t-1, t, t+1, t+2] within the predicted series.\n  -- With only 4 days available, this effectively averages over the available neighbors.\n  SELECT\n    sale_date,\n    AVG(pred_sales) OVER (\n      ORDER BY sale_date\n      ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING\n    ) AS ma5\n  FROM predicted_sales\n)\nSELECT\n  SUM(ma5) AS sum_of_5day_symmetric_moving_averages\nFROM moving_avg_5\nWHERE sale_date BETWEEN DATE('2018-12-05') AND DATE('2018-12-08');\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "1": "WITH delivered_orders AS (\n  SELECT\n    o.order_id,\n    o.customer_id,\n    o.order_purchase_timestamp\n  FROM olist_orders AS o\n  WHERE o.order_status = 'delivered'\n),\norder_payments AS (\n  SELECT\n    op.order_id,\n    SUM(op.payment_value) AS order_payment_value\n  FROM olist_order_payments AS op\n  GROUP BY op.order_id\n),\ncustomer_orders AS (\n  SELECT\n    c.customer_unique_id,\n    d.order_id,\n    d.order_purchase_timestamp,\n    COALESCE(p.order_payment_value, 0) AS order_payment_value\n  FROM delivered_orders AS d\n  INNER JOIN olist_customers AS c\n    ON c.customer_id = d.customer_id\n  INNER JOIN order_payments AS p\n    ON p.order_id = d.order_id\n),\ncustomer_rfm_base AS (\n  SELECT\n    customer_unique_id,\n    MAX(order_purchase_timestamp) AS latest_purchase_ts,\n    COUNT(DISTINCT order_id) AS frequency_orders,\n    SUM(order_payment_value) AS monetary_total\n  FROM customer_orders\n  GROUP BY customer_unique_id\n),\nrfm_with_recency AS (\n  SELECT\n    b.*,\n    CAST(\n      julianday((SELECT MAX(order_purchase_timestamp) FROM delivered_orders)) - julianday(b.latest_purchase_ts)\n      AS INTEGER\n    ) AS recency_days\n  FROM customer_rfm_base AS b\n),\nrfm_scored AS (\n  SELECT\n    r.*,\n    /* Scores are percentile-based (quintiles). Lower score = better (more recent / more frequent / higher spend). */\n    NTILE(5) OVER (ORDER BY recency_days ASC) AS r_score,\n    NTILE(5) OVER (ORDER BY frequency_orders DESC) AS f_score,\n    NTILE(5) OVER (ORDER BY monetary_total DESC) AS m_score\n  FROM rfm_with_recency AS r\n),\nrfm_segmented AS (\n  SELECT\n    customer_unique_id,\n    r_score,\n    f_score,\n    m_score,\n    (f_score + m_score) AS fm_score,\n    CASE\n      WHEN r_score = 1 AND (f_score + m_score) BETWEEN 1 AND 4 THEN 'Champions'\n      WHEN r_score IN (4,5) AND (f_score + m_score) BETWEEN 1 AND 2 THEN 'Can''t Lose Them'\n      WHEN r_score IN (4,5) AND (f_score + m_score) BETWEEN 3 AND 6 THEN 'Hibernating'\n      WHEN r_score IN (4,5) AND (f_score + m_score) BETWEEN 7 AND 10 THEN 'Lost'\n      WHEN r_score IN (2,3) AND (f_score + m_score) BETWEEN 1 AND 4 THEN 'Loyal Customers'\n      WHEN r_score = 3 AND (f_score + m_score) BETWEEN 5 AND 6 THEN 'Needs Attention'\n      WHEN r_score = 1 AND (f_score + m_score) BETWEEN 7 AND 8 THEN 'Recent Users'\n      WHEN (r_score = 1 AND (f_score + m_score) BETWEEN 5 AND 6)\n        OR (r_score = 2 AND (f_score + m_score) BETWEEN 5 AND 8) THEN 'Potential Loyalists'\n      WHEN r_score = 1 AND (f_score + m_score) BETWEEN 9 AND 10 THEN 'Price Sensitive'\n      WHEN r_score = 2 AND (f_score + m_score) BETWEEN 9 AND 10 THEN 'Promising'\n      WHEN r_score = 3 AND (f_score + m_score) BETWEEN 7 AND 10 THEN 'About to Sleep'\n      ELSE 'Other'\n    END AS rfm_segment\n  FROM rfm_scored\n),\ncustomer_avg_sales AS (\n  SELECT\n    co.customer_unique_id,\n    SUM(co.order_payment_value) * 1.0 / COUNT(DISTINCT co.order_id) AS avg_sales_per_order\n  FROM customer_orders AS co\n  GROUP BY co.customer_unique_id\n)\nSELECT\n  s.rfm_segment,\n  AVG(a.avg_sales_per_order) AS avg_sales_per_order_across_customers\nFROM rfm_segmented AS s\nINNER JOIN customer_avg_sales AS a\n  ON a.customer_unique_id = s.customer_unique_id\nGROUP BY s.rfm_segment\nORDER BY avg_sales_per_order_across_customers DESC;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "2": "WITH customer_avg_payment AS (\n  SELECT\n    c.customer_id,\n    AVG(p.payment_value) AS avg_payment_per_order\n  FROM olist_customers AS c\n  INNER JOIN olist_orders AS o\n    ON o.customer_id = c.customer_id\n  INNER JOIN olist_order_payments AS p\n    ON p.order_id = o.order_id\n  GROUP BY c.customer_id\n),\ntop3_customers AS (\n  SELECT customer_id\n  FROM customer_avg_payment\n  ORDER BY avg_payment_per_order DESC\n  LIMIT 3\n),\ncustomer_lifespan AS (\n  SELECT\n    c.customer_id,\n    MIN(o.order_purchase_timestamp) AS first_purchase_ts,\n    MAX(o.order_purchase_timestamp) AS last_purchase_ts\n  FROM olist_customers AS c\n  INNER JOIN olist_orders AS o\n    ON o.customer_id = c.customer_id\n  INNER JOIN top3_customers AS t\n    ON t.customer_id = c.customer_id\n  GROUP BY c.customer_id\n)\nSELECT\n  c.customer_id,\n  COUNT(DISTINCT o.order_id) AS number_of_orders,\n  AVG(p.payment_value) AS avg_payment_per_order,\n  CASE\n    WHEN (julianday(l.last_purchase_ts) - julianday(l.first_purchase_ts)) < 7 THEN 1.0\n    ELSE (julianday(l.last_purchase_ts) - julianday(l.first_purchase_ts)) / 7.0\n  END AS customer_lifespan_weeks\nFROM olist_customers AS c\nINNER JOIN top3_customers AS t\n  ON t.customer_id = c.customer_id\nINNER JOIN olist_orders AS o\n  ON o.customer_id = c.customer_id\nINNER JOIN olist_order_payments AS p\n  ON p.order_id = o.order_id\nINNER JOIN customer_lifespan AS l\n  ON l.customer_id = c.customer_id\nGROUP BY\n  c.customer_id,\n  l.first_purchase_ts,\n  l.last_purchase_ts\nORDER BY avg_payment_per_order DESC;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "3": "WITH per_player AS (\n  SELECT\n    (\n      ROUND(ABS((julianday(p.final_game) - julianday(p.debut)) / 365.0), 2) +\n      ROUND(ABS((julianday(p.final_game) - julianday(p.debut)) / 30.0) / 12.0, 2) +\n      ROUND(ABS((julianday(p.final_game) - julianday(p.debut)) / 365.0), 2)\n    ) AS career_span\n  FROM player AS p\n  WHERE p.debut IS NOT NULL\n    AND p.final_game IS NOT NULL\n)\nSELECT CAST(ROUND(AVG(career_span), 2) AS REAL) AS avg_career_span_years\nFROM per_player;\t----- bird -----\tBaseball_spider2",
    "4": "SELECT\n  p.name_given,\n  SUM(b.g)  AS total_games_played,\n  SUM(b.r)  AS total_runs,\n  SUM(b.h)  AS total_hits,\n  SUM(b.hr) AS total_home_runs\nFROM player AS p\nINNER JOIN batting AS b\n  ON p.player_id = b.player_id\nGROUP BY\n  p.name_given\nORDER BY\n  total_games_played DESC,\n  total_runs DESC,\n  total_hits DESC,\n  total_home_runs DESC\nLIMIT 1;\t----- bird -----\tBaseball_spider2",
    "5": "WITH abakan_airports AS (\n  SELECT\n    airport_code,\n    coordinates\n  FROM airports_data\n  WHERE city = 'Abakan'\n),\nabakan_flights AS (\n  SELECT\n    f.flight_id,\n    dep.coordinates AS dep_coord,\n    arr.coordinates AS arr_coord\n  FROM flights AS f\n  INNER JOIN airports_data AS dep\n    ON dep.airport_code = f.departure_airport\n  INNER JOIN airports_data AS arr\n    ON arr.airport_code = f.arrival_airport\n  WHERE f.departure_airport IN (SELECT airport_code FROM abakan_airports)\n     OR f.arrival_airport   IN (SELECT airport_code FROM abakan_airports)\n),\ndistances AS (\n  SELECT\n    2.0 * 6371.0 * asin(\n      sqrt(\n        pow(\n          sin(\n            (\n              (CAST(substr(arr_coord, instr(arr_coord, ',') + 1) AS REAL) -\n               CAST(substr(dep_coord, instr(dep_coord, ',') + 1) AS REAL)\n              ) * pi() / 180.0\n            ) / 2.0\n          ),\n          2\n        )\n        +\n        cos(CAST(substr(dep_coord, instr(dep_coord, ',') + 1) AS REAL) * pi() / 180.0)\n        * cos(CAST(substr(arr_coord, instr(arr_coord, ',') + 1) AS REAL) * pi() / 180.0)\n        * pow(\n            sin(\n              (\n                (CAST(substr(arr_coord, 2, instr(arr_coord, ',') - 2) AS REAL) -\n                 CAST(substr(dep_coord, 2, instr(dep_coord, ',') - 2) AS REAL)\n                ) * pi() / 180.0\n              ) / 2.0\n            ),\n            2\n          )\n      )\n    ) AS distance_km\n  FROM abakan_flights\n)\nSELECT MAX(distance_km) AS longest_route_distance_km\nFROM distances;\t----- bird -----\tAirlines_spider2",
    "6": "WITH flight_city_dist AS (\n  SELECT\n    CASE\n      WHEN dep.city <= arr.city THEN dep.city\n      ELSE arr.city\n    END AS city1,\n    CASE\n      WHEN dep.city <= arr.city THEN arr.city\n      ELSE dep.city\n    END AS city2,\n    (\n      2 * 6371 * asin(\n        sqrt(\n          pow(sin(((radians(arr_lat) - radians(dep_lat)) / 2)), 2) +\n          cos(radians(dep_lat)) * cos(radians(arr_lat)) *\n          pow(sin(((radians(arr_lon) - radians(dep_lon)) / 2)), 2)\n        )\n      )\n    ) AS distance_km\n  FROM (\n    SELECT\n      f.departure_airport,\n      f.arrival_airport,\n      CAST(substr(dep_ad.coordinates, 2, instr(dep_ad.coordinates, ',') - 2) AS REAL) AS dep_lon,\n      CAST(substr(dep_ad.coordinates, instr(dep_ad.coordinates, ',') + 2, length(dep_ad.coordinates) - instr(dep_ad.coordinates, ',') - 2) AS REAL) AS dep_lat,\n      CAST(substr(arr_ad.coordinates, 2, instr(arr_ad.coordinates, ',') - 2) AS REAL) AS arr_lon,\n      CAST(substr(arr_ad.coordinates, instr(arr_ad.coordinates, ',') + 2, length(arr_ad.coordinates) - instr(arr_ad.coordinates, ',') - 2) AS REAL) AS arr_lat\n    FROM flights AS f\n    INNER JOIN airports_data AS dep_ad\n      ON f.departure_airport = dep_ad.airport_code\n    INNER JOIN airports_data AS arr_ad\n      ON f.arrival_airport = arr_ad.airport_code\n  ) AS x\n  INNER JOIN airports_data AS dep\n    ON x.departure_airport = dep.airport_code\n  INNER JOIN airports_data AS arr\n    ON x.arrival_airport = arr.airport_code\n),\navg_city_pair AS (\n  SELECT\n    city1,\n    city2,\n    AVG(distance_km) AS avg_distance_km\n  FROM flight_city_dist\n  GROUP BY city1, city2\n),\nbinned AS (\n  SELECT\n    CASE\n      WHEN avg_distance_km < 1000 THEN '0-999'\n      WHEN avg_distance_km < 2000 THEN '1000-1999'\n      WHEN avg_distance_km < 3000 THEN '2000-2999'\n      WHEN avg_distance_km < 4000 THEN '3000-3999'\n      WHEN avg_distance_km < 5000 THEN '4000-4999'\n      WHEN avg_distance_km < 6000 THEN '5000-5999'\n      ELSE '6000+'\n    END AS distance_range,\n    COUNT(*) AS pair_count\n  FROM avg_city_pair\n  GROUP BY distance_range\n)\nSELECT pair_count\nFROM binned\nORDER BY pair_count ASC\nLIMIT 1;\t----- bird -----\tAirlines_spider2",
    "7": "WITH helmet_collisions AS (\n  SELECT DISTINCT p.case_id\n  FROM parties AS p\n  WHERE p.party_safety_equipment_1 = 'Helmet'\n     OR p.party_safety_equipment_2 = 'Helmet'\n),\nno_helmet_collisions AS (\n  SELECT DISTINCT p.case_id\n  FROM parties AS p\n  WHERE p.party_safety_equipment_1 = 'No Helmet'\n     OR p.party_safety_equipment_2 = 'No Helmet'\n),\nhelmet_stats AS (\n  SELECT\n    'Helmet' AS helmet_usage,\n    SUM(c.motorcyclist_killed_count) AS total_motorcyclist_fatalities,\n    COUNT(*) AS total_collisions\n  FROM collisions AS c\n  INNER JOIN helmet_collisions AS hc\n    ON hc.case_id = c.case_id\n),\nno_helmet_stats AS (\n  SELECT\n    'No Helmet' AS helmet_usage,\n    SUM(c.motorcyclist_killed_count) AS total_motorcyclist_fatalities,\n    COUNT(*) AS total_collisions\n  FROM collisions AS c\n  INNER JOIN no_helmet_collisions AS nhc\n    ON nhc.case_id = c.case_id\n)\nSELECT\n  helmet_usage,\n  100.0 * total_motorcyclist_fatalities / NULLIF(total_collisions, 0) AS fatality_rate_percent\nFROM helmet_stats\nUNION ALL\nSELECT\n  helmet_usage,\n  100.0 * total_motorcyclist_fatalities / NULLIF(total_collisions, 0) AS fatality_rate_percent\nFROM no_helmet_stats;\t----- bird -----\tCalifornia_Traffic_Collision_spider2",
    "8": "WITH year_cause_counts AS (\n  SELECT\n    ci.db_year,\n    c.primary_collision_factor,\n    COUNT(*) AS cause_cnt\n  FROM case_ids AS ci\n  INNER JOIN collisions AS c\n    ON c.case_id = ci.case_id\n  GROUP BY\n    ci.db_year,\n    c.primary_collision_factor\n),\nranked_causes AS (\n  SELECT\n    db_year,\n    primary_collision_factor,\n    cause_cnt,\n    DENSE_RANK() OVER (\n      PARTITION BY db_year\n      ORDER BY cause_cnt DESC\n    ) AS rnk\n  FROM year_cause_counts\n),\ntop2_causes AS (\n  SELECT\n    db_year,\n    primary_collision_factor\n  FROM ranked_causes\n  WHERE rnk <= 2\n),\nyear_top2_signature AS (\n  SELECT\n    db_year,\n    GROUP_CONCAT(primary_collision_factor, '||') AS top2_signature\n  FROM (\n    SELECT db_year, primary_collision_factor\n    FROM top2_causes\n    ORDER BY db_year, primary_collision_factor\n  )\n  GROUP BY db_year\n)\nSELECT y1.db_year\nFROM year_top2_signature AS y1\nWHERE EXISTS (\n  SELECT 1\n  FROM year_top2_signature AS y2\n  WHERE y2.top2_signature <> y1.top2_signature\n);\t----- bird -----\tCalifornia_Traffic_Collision_spider2",
    "9": "WITH\nc2011 AS (\n  SELECT\n    c.pcf_violation_category,\n    COUNT(*) AS cnt_2011\n  FROM collisions AS c\n  WHERE strftime('%Y', c.collision_date) = '2011'\n  GROUP BY c.pcf_violation_category\n),\nc2021 AS (\n  SELECT\n    c.pcf_violation_category,\n    COUNT(*) AS cnt_2021\n  FROM collisions AS c\n  WHERE strftime('%Y', c.collision_date) = '2021'\n  GROUP BY c.pcf_violation_category\n),\ntop_2021 AS (\n  SELECT\n    pcf_violation_category\n  FROM c2021\n  ORDER BY cnt_2021 DESC\n  LIMIT 1\n)\nSELECT\n  CAST((c2021.cnt_2021 - c2011.cnt_2011) AS REAL) * 100.0 / c2021.cnt_2021 AS percentage_point_decrease\nFROM top_2021\nINNER JOIN c2021\n  ON c2021.pcf_violation_category = top_2021.pcf_violation_category\nINNER JOIN c2011\n  ON c2011.pcf_violation_category = top_2021.pcf_violation_category;\t----- bird -----\tCalifornia_Traffic_Collision_spider2",
    "10": "SELECT w_winner.name AS winner_name,\n       w_loser.name  AS loser_name\nFROM Matches AS m\nINNER JOIN Belts AS b\n  ON b.id = m.title_id\nINNER JOIN Wrestlers AS w_winner\n  ON w_winner.id = m.winner_id\nINNER JOIN Wrestlers AS w_loser\n  ON w_loser.id = m.loser_id\nWHERE b.name = 'NXT Championship'\n  AND m.title_change = 0\nORDER BY m.duration ASC\nLIMIT 1;\t----- bird -----\tWWE_spider2",
    "11": "WITH over_runs AS (\n  SELECT\n    b.match_id,\n    b.over_id,\n    b.bowler,\n    COALESCE(SUM(e.extra_runs), 0) AS runs_conceded\n  FROM ball_by_ball AS b\n  INNER JOIN extra_runs AS e\n    ON b.match_id = e.match_id\n   AND b.innings_no = e.innings_no\n   AND b.over_id = e.over_id\n   AND b.ball_id = e.ball_id\n  GROUP BY\n    b.match_id, b.over_id, b.bowler\n),\nmax_over_per_match AS (\n  SELECT\n    match_id,\n    MAX(runs_conceded) AS max_runs_in_match\n  FROM over_runs\n  GROUP BY match_id\n),\ncandidate_overs AS (\n  -- only overs that had the most runs conceded within their match\n  SELECT\n    o.match_id,\n    o.bowler,\n    o.runs_conceded\n  FROM over_runs AS o\n  INNER JOIN max_over_per_match AS m\n    ON o.match_id = m.match_id\n   AND o.runs_conceded = m.max_runs_in_match\n),\nbowler_best AS (\n  -- for each bowler, their maximum such over across all matches\n  SELECT\n    bowler,\n    MAX(runs_conceded) AS best_runs_conceded\n  FROM candidate_overs\n  GROUP BY bowler\n),\ntop3 AS (\n  SELECT\n    bowler,\n    best_runs_conceded\n  FROM bowler_best\n  ORDER BY best_runs_conceded DESC\n  LIMIT 3\n)\nSELECT\n  t.bowler,\n  c.match_id\nFROM top3 AS t\nINNER JOIN candidate_overs AS c\n  ON c.bowler = t.bowler\n AND c.runs_conceded = t.best_runs_conceded\nORDER BY\n  t.best_runs_conceded DESC,\n  t.bowler,\n  c.match_id;\t----- bird -----\tIPL_spider2",
    "12": "SELECT\n  p.player_name\nFROM ball_by_ball AS b\nINNER JOIN wicket_taken AS w\n  ON b.match_id = w.match_id\n AND b.innings_no = w.innings_no\n AND b.over_id = w.over_id\n AND b.ball_id = w.ball_id\nINNER JOIN batsman_scored AS bs\n  ON b.match_id = bs.match_id\n AND b.innings_no = bs.innings_no\n AND b.over_id = bs.over_id\n AND b.ball_id = bs.ball_id\nINNER JOIN extra_runs AS er\n  ON b.match_id = er.match_id\n AND b.innings_no = er.innings_no\n AND b.over_id = er.over_id\n AND b.ball_id = er.ball_id\nINNER JOIN player AS p\n  ON p.player_id = b.bowler\nWHERE w.kind_out NOT IN ('run out', 'retired hurt', 'obstructing the field')\nGROUP BY\n  b.bowler\nORDER BY\n  (SUM(bs.runs_scored + er.extra_runs) * 1.0) / COUNT(w.kind_out) ASC\nLIMIT 1;\t----- bird -----\tIPL_spider2",
    "13": "WITH striker_match_runs AS (\n  SELECT\n    bbb.striker AS striker_id,\n    bs.match_id,\n    SUM(bs.runs_scored) AS total_runs\n  FROM ball_by_ball AS bbb\n  INNER JOIN batsman_scored AS bs\n    ON bbb.match_id = bs.match_id\n   AND bbb.innings_no = bs.innings_no\n   AND bbb.over_id = bs.over_id\n   AND bbb.ball_id = bs.ball_id\n  GROUP BY\n    bbb.striker,\n    bs.match_id\n),\nqualified AS (\n  SELECT total_runs\n  FROM striker_match_runs\n  WHERE total_runs > 50\n)\nSELECT AVG(total_runs) AS avg_total_runs\nFROM qualified;\t----- bird -----\tIPL_spider2",
    "14": "SELECT DISTINCT p.player_name\nFROM match AS m\nINNER JOIN batsman_scored AS bs\n  ON bs.match_id = m.match_id\nINNER JOIN ball_by_ball AS bbb\n  ON bbb.match_id = bs.match_id\n AND bbb.innings_no = bs.innings_no\n AND bbb.over_id = bs.over_id\n AND bbb.ball_id = bs.ball_id\nINNER JOIN player AS p\n  ON p.player_id = bbb.striker\nINNER JOIN player_match AS pm\n  ON pm.match_id = m.match_id\n AND pm.player_id = p.player_id\nINNER JOIN team AS t\n  ON t.team_id = pm.team_id\nWHERE t.name <> m.match_winner\nGROUP BY m.match_id, p.player_id, p.player_name\nHAVING SUM(bs.runs_scored) >= 100;\t----- bird -----\tIPL_spider2",
    "15": "SELECT\n  p.player_name,\n  CAST(SUM(bs.runs_scored) AS REAL) / COUNT(DISTINCT m.match_id) AS batting_average\nFROM match AS m\nINNER JOIN batsman_scored AS bs\n  ON bs.match_id = m.match_id\nINNER JOIN ball_by_ball AS bbb\n  ON bbb.match_id = bs.match_id\n AND bbb.innings_no = bs.innings_no\n AND bbb.over_id = bs.over_id\n AND bbb.ball_id = bs.ball_id\nINNER JOIN player AS p\n  ON p.player_id = bbb.striker\nWHERE m.season_id = 5\nGROUP BY p.player_name\nORDER BY batting_average DESC\nLIMIT 5;\t----- bird -----\tIPL_spider2",
    "16": "WITH player_match_runs AS (\n  SELECT\n    pm.player_id,\n    pm.match_id,\n    SUM(bs.runs_scored) AS runs_in_match\n  FROM player_match AS pm\n  INNER JOIN ball_by_ball AS bbb\n    ON bbb.match_id = pm.match_id\n   AND bbb.striker = pm.player_id\n  INNER JOIN batsman_scored AS bs\n    ON bs.match_id = bbb.match_id\n   AND bs.innings_no = bbb.innings_no\n   AND bs.over_id = bbb.over_id\n   AND bs.ball_id = bbb.ball_id\n  GROUP BY\n    pm.player_id,\n    pm.match_id\n),\nplayer_avg_runs AS (\n  SELECT\n    pmr.player_id,\n    AVG(pmr.runs_in_match) AS avg_runs_per_match\n  FROM player_match_runs AS pmr\n  GROUP BY\n    pmr.player_id\n),\ncountry_avg_of_player_avgs AS (\n  SELECT\n    p.country_name,\n    AVG(par.avg_runs_per_match) AS country_batting_average\n  FROM player_avg_runs AS par\n  INNER JOIN player AS p\n    ON p.player_id = par.player_id\n  GROUP BY\n    p.country_name\n)\nSELECT\n  country_name,\n  country_batting_average\nFROM country_avg_of_player_avgs\nORDER BY country_batting_average DESC\nLIMIT 5;\t----- bird -----\tIPL_spider2",
    "17": "WITH over_totals AS (\n  SELECT\n    b.match_id,\n    b.innings_no,\n    b.over_id,\n    SUM(COALESCE(bs.runs_scored, 0)) AS batsman_runs,\n    SUM(COALESCE(er.extra_runs, 0)) AS extra_runs,\n    SUM(COALESCE(bs.runs_scored, 0) + COALESCE(er.extra_runs, 0)) AS total_runs\n  FROM ball_by_ball AS b\n  LEFT JOIN batsman_scored AS bs\n    ON bs.match_id = b.match_id\n   AND bs.innings_no = b.innings_no\n   AND bs.over_id = b.over_id\n   AND bs.ball_id = b.ball_id\n  LEFT JOIN extra_runs AS er\n    ON er.match_id = b.match_id\n   AND er.innings_no = b.innings_no\n   AND er.over_id = b.over_id\n   AND er.ball_id = b.ball_id\n  GROUP BY\n    b.match_id,\n    b.innings_no,\n    b.over_id\n),\nmax_over_per_match AS (\n  SELECT\n    match_id,\n    MAX(total_runs) AS max_over_total\n  FROM over_totals\n  GROUP BY match_id\n)\nSELECT\n  AVG(m.max_over_total) AS avg_highest_over_total_across_matches\nFROM max_over_per_match AS m;\t----- bird -----\tIPL_spider2",
    "18": "SELECT\n  CAST(strftime('%m', o.order_purchase_timestamp) AS INTEGER) AS month,\n  SUM(CASE WHEN strftime('%Y', o.order_purchase_timestamp) = '2016' THEN 1 ELSE 0 END) AS delivered_2016,\n  SUM(CASE WHEN strftime('%Y', o.order_purchase_timestamp) = '2017' THEN 1 ELSE 0 END) AS delivered_2017,\n  SUM(CASE WHEN strftime('%Y', o.order_purchase_timestamp) = '2018' THEN 1 ELSE 0 END) AS delivered_2018\nFROM olist_orders AS o\nWHERE o.order_status = 'delivered'\n  AND strftime('%Y', o.order_purchase_timestamp) IN ('2016', '2017', '2018')\nGROUP BY CAST(strftime('%m', o.order_purchase_timestamp) AS INTEGER)\nORDER BY month;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "19": "WITH delivered_by_year AS (\n  SELECT\n    CAST(strftime('%Y', olist_orders.order_delivered_customer_date) AS INTEGER) AS yr,\n    COUNT(olist_orders.order_id) AS delivered_cnt\n  FROM olist_orders\n  WHERE olist_orders.order_delivered_customer_date IS NOT NULL\n  GROUP BY CAST(strftime('%Y', olist_orders.order_delivered_customer_date) AS INTEGER)\n),\nlowest_year AS (\n  SELECT yr\n  FROM delivered_by_year\n  WHERE yr IN (2016, 2017, 2018)\n  ORDER BY delivered_cnt ASC\n  LIMIT 1\n),\ndelivered_by_month AS (\n  SELECT\n    CAST(strftime('%m', olist_orders.order_delivered_customer_date) AS INTEGER) AS mon,\n    COUNT(olist_orders.order_id) AS delivered_cnt\n  FROM olist_orders\n  WHERE olist_orders.order_delivered_customer_date IS NOT NULL\n    AND CAST(strftime('%Y', olist_orders.order_delivered_customer_date) AS INTEGER) = (SELECT yr FROM lowest_year)\n  GROUP BY CAST(strftime('%m', olist_orders.order_delivered_customer_date) AS INTEGER)\n)\nSELECT delivered_cnt\nFROM delivered_by_month\nORDER BY delivered_cnt DESC\nLIMIT 1;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "20": "SELECT\n  c.customer_unique_id,\n  AVG(p.payment_value) AS avg_payment_value,\n  c.customer_city,\n  c.customer_state\nFROM olist_orders AS o\nINNER JOIN olist_customers AS c\n  ON o.customer_id = c.customer_id\nINNER JOIN olist_order_payments AS p\n  ON o.order_id = p.order_id\nWHERE o.order_status = 'delivered'\nGROUP BY c.customer_unique_id\nORDER BY COUNT(o.order_id) DESC\nLIMIT 3;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "21": "WITH city_totals AS (\n  SELECT\n    c.customer_city,\n    SUM(p.payment_value) AS total_payments,\n    COUNT(o.order_id) AS delivered_order_count\n  FROM olist_orders AS o\n  INNER JOIN olist_customers AS c\n    ON o.customer_id = c.customer_id\n  INNER JOIN olist_order_payments AS p\n    ON o.order_id = p.order_id\n  WHERE o.order_status = 'delivered'\n  GROUP BY c.customer_city\n  ORDER BY total_payments ASC\n  LIMIT 5\n)\nSELECT\n  AVG(total_payments) AS avg_total_payments,\n  AVG(delivered_order_count) AS avg_total_delivered_order_counts\nFROM city_totals;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "22": "WITH delivered AS (\n  SELECT\n    oi.seller_id,\n    o.order_id,\n    o.customer_id,\n    oi.price,\n    oi.freight_value\n  FROM olist_orders AS o\n  INNER JOIN olist_order_items AS oi\n    ON oi.order_id = o.order_id\n  WHERE o.order_status = 'delivered'\n),\ntop_distinct_customers AS (\n  SELECT\n    d.seller_id,\n    COUNT(DISTINCT c.customer_unique_id) AS value\n  FROM delivered AS d\n  INNER JOIN olist_customers AS c\n    ON c.customer_id = d.customer_id\n  GROUP BY d.seller_id\n  ORDER BY value DESC\n  LIMIT 1\n),\ntop_profit AS (\n  SELECT\n    d.seller_id,\n    SUM(d.price - d.freight_value) AS value\n  FROM delivered AS d\n  GROUP BY d.seller_id\n  ORDER BY value DESC\n  LIMIT 1\n),\ntop_distinct_orders AS (\n  SELECT\n    d.seller_id,\n    COUNT(DISTINCT d.order_id) AS value\n  FROM delivered AS d\n  GROUP BY d.seller_id\n  ORDER BY value DESC\n  LIMIT 1\n),\ntop_5star_reviews AS (\n  SELECT\n    oi.seller_id,\n    COUNT(r.review_id) AS value\n  FROM olist_orders AS o\n  INNER JOIN olist_order_items AS oi\n    ON oi.order_id = o.order_id\n  INNER JOIN olist_order_reviews AS r\n    ON r.order_id = o.order_id\n  WHERE o.order_status = 'delivered'\n    AND r.review_score = 5\n  GROUP BY oi.seller_id\n  ORDER BY value DESC\n  LIMIT 1\n)\nSELECT\n  'seller with the highest number of distinct customer unique IDs' AS achievement,\n  seller_id,\n  value\nFROM top_distinct_customers\n\nUNION ALL\n\nSELECT\n  'seller with the highest profit (price minus freight value)' AS achievement,\n  seller_id,\n  value\nFROM top_profit\n\nUNION ALL\n\nSELECT\n  'seller with the highest number of distinct orders' AS achievement,\n  seller_id,\n  value\nFROM top_distinct_orders\n\nUNION ALL\n\nSELECT\n  'seller with the most 5-star ratings' AS achievement,\n  seller_id,\n  value\nFROM top_5star_reviews;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "23": "WITH payment_counts AS (\n  SELECT\n    p.product_category_name,\n    op.payment_type,\n    COUNT(*) AS payment_cnt\n  FROM olist_order_items oi\n  INNER JOIN olist_products p\n    ON p.product_id = oi.product_id\n  INNER JOIN olist_order_payments op\n    ON op.order_id = oi.order_id\n  GROUP BY\n    p.product_category_name,\n    op.payment_type\n),\nranked AS (\n  SELECT\n    product_category_name,\n    payment_type,\n    payment_cnt,\n    ROW_NUMBER() OVER (\n      PARTITION BY product_category_name\n      ORDER BY payment_cnt DESC\n    ) AS rn\n  FROM payment_counts\n)\nSELECT\n  r.product_category_name,\n  AVG(op.payment_value) AS avg_payment_value\nFROM ranked r\nINNER JOIN olist_order_items oi\n  ON 1 = 1\nINNER JOIN olist_products p\n  ON p.product_id = oi.product_id\nINNER JOIN olist_order_payments op\n  ON op.order_id = oi.order_id\nWHERE\n  p.product_category_name = r.product_category_name\n  AND op.payment_type = r.payment_type\n  AND r.rn = 1\nGROUP BY\n  r.product_category_name;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "24": "WITH top_payment_types AS (\n  SELECT\n    olist_order_payments.payment_type\n  FROM olist_order_payments\n  GROUP BY olist_order_payments.payment_type\n  ORDER BY COUNT(olist_order_payments.order_id) DESC\n  LIMIT 3\n)\nSELECT\n  olist_products.product_category_name,\n  COUNT(olist_order_payments.order_id) AS num_payments\nFROM olist_order_payments\nINNER JOIN olist_order_items\n  ON olist_order_items.order_id = olist_order_payments.order_id\nINNER JOIN olist_products\n  ON olist_products.product_id = olist_order_items.product_id\nWHERE olist_order_payments.payment_type IN (\n  SELECT payment_type FROM top_payment_types\n)\nGROUP BY olist_products.product_category_name\nORDER BY COUNT(olist_order_payments.order_id) DESC\nLIMIT 3;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "25": "WITH ordered AS (\n  SELECT\n    geolocation_state,\n    geolocation_city,\n    geolocation_zip_code_prefix,\n    geolocation_lat,\n    geolocation_lng,\n    LAG(geolocation_state) OVER (\n      ORDER BY geolocation_state, geolocation_city, geolocation_zip_code_prefix, geolocation_lat, geolocation_lng\n    ) AS prev_state,\n    LAG(geolocation_city) OVER (\n      ORDER BY geolocation_state, geolocation_city, geolocation_zip_code_prefix, geolocation_lat, geolocation_lng\n    ) AS prev_city,\n    LAG(geolocation_zip_code_prefix) OVER (\n      ORDER BY geolocation_state, geolocation_city, geolocation_zip_code_prefix, geolocation_lat, geolocation_lng\n    ) AS prev_zip,\n    LAG(geolocation_lat) OVER (\n      ORDER BY geolocation_state, geolocation_city, geolocation_zip_code_prefix, geolocation_lat, geolocation_lng\n    ) AS prev_lat,\n    LAG(geolocation_lng) OVER (\n      ORDER BY geolocation_state, geolocation_city, geolocation_zip_code_prefix, geolocation_lat, geolocation_lng\n    ) AS prev_lng\n  FROM olist_geolocation\n),\ndistances AS (\n  SELECT\n    prev_city AS predecessor_city,\n    geolocation_city AS city,\n    6371.0 * acos(\n      cos(radians(prev_lat)) * cos(radians(geolocation_lat)) *\n      cos(radians(geolocation_lng) - radians(prev_lng)) +\n      sin(radians(prev_lat)) * sin(radians(geolocation_lat))\n    ) AS distance_km\n  FROM ordered\n  WHERE prev_lat IS NOT NULL AND prev_lng IS NOT NULL\n)\nSELECT\n  predecessor_city,\n  city\nFROM distances\nORDER BY distance_km DESC\nLIMIT 1;\t----- bird -----\tBrazilian_E_Commerce_spider2",
    "26": "SELECT\n  a.first_name,\n  a.last_name\nFROM film AS f\nINNER JOIN language AS l\n  ON f.language_id = l.language_id\nINNER JOIN film_category AS fc\n  ON f.film_id = fc.film_id\nINNER JOIN category AS c\n  ON fc.category_id = c.category_id\nINNER JOIN film_actor AS fa\n  ON f.film_id = fa.film_id\nINNER JOIN actor AS a\n  ON fa.actor_id = a.actor_id\nWHERE l.name = 'English'\n  AND c.name = 'Children'\n  AND f.rating IN ('G', 'PG')\n  AND f.length <= 120\n  AND f.release_year BETWEEN 2000 AND 2010\nGROUP BY a.actor_id\nORDER BY COUNT(f.film_id) DESC\nLIMIT 1;\t----- bird -----\tPagila_spider2",
    "27": "SELECT\n  c.name\nFROM city AS ci\nINNER JOIN address AS a\n  ON a.city_id = ci.city_id\nINNER JOIN customer AS cu\n  ON cu.address_id = a.address_id\nINNER JOIN rental AS r\n  ON r.customer_id = cu.customer_id\nINNER JOIN inventory AS i\n  ON i.inventory_id = r.inventory_id\nINNER JOIN film AS f\n  ON f.film_id = i.film_id\nINNER JOIN film_category AS fc\n  ON fc.film_id = f.film_id\nINNER JOIN category AS c\n  ON c.category_id = fc.category_id\nWHERE ci.city LIKE 'A%'\n   OR ci.city LIKE '%-%'\nGROUP BY c.name\nORDER BY SUM(f.rental_duration * 24) DESC\nLIMIT 1;\t----- bird -----\tPagila_spider2",
    "28": "SELECT\n  t.boroname,\n  AVG(it.Estimate_Mean_income) AS avg_mean_income\nFROM trees AS t\nINNER JOIN income_trees AS it\n  ON t.zipcode = it.zipcode\nWHERE\n  it.Estimate_Mean_income > 0\n  AND it.Estimate_Median_income > 0\n  AND t.boroname IS NOT NULL\n  AND t.boroname <> ''\nGROUP BY\n  t.boroname\nORDER BY\n  COUNT(*) DESC\nLIMIT 3;\t----- bird -----\tmodern_data_spider2",
    "29": "SELECT\n  CAST(COUNT(*) AS REAL) * 100.0 / (\n    SELECT COUNT(*)\n    FROM trees\n    WHERE boroname = 'Bronx'\n  ) AS percentage_good\nFROM trees\nWHERE boroname = 'Bronx'\n  AND health = 'Good';\t----- bird -----\tmodern_data_spider2",
    "30": "WITH yearly_counts AS (\n  SELECT\n    cd.year_founded,\n    COUNT(cf.company_id) AS new_unicorns\n  FROM companies_dates AS cd\n  INNER JOIN companies_funding AS cf\n    ON cd.company_id = cf.company_id\n  WHERE cd.year_founded BETWEEN 2019 AND 2021\n    AND cf.funding = 'unicorn'\n  GROUP BY cd.year_founded\n)\nSELECT\n  AVG(new_unicorns) AS avg_new_unicorns_per_year\nFROM yearly_counts;\t----- bird -----\tmodern_data_spider2",
    "31": "WITH best_selling_track AS (\n  SELECT\n    ii.TrackId\n  FROM invoice_items AS ii\n  GROUP BY\n    ii.TrackId\n  ORDER BY\n    SUM(ii.Quantity) DESC\n  LIMIT 1\n)\nSELECT\n  c.FirstName,\n  SUM(ii.UnitPrice * ii.Quantity) AS AmountSpent\nFROM invoice_items AS ii\nINNER JOIN invoices AS i\n  ON ii.InvoiceId = i.InvoiceId\nINNER JOIN customers AS c\n  ON i.CustomerId = c.CustomerId\nWHERE\n  ii.TrackId IN (SELECT TrackId FROM best_selling_track)\nGROUP BY\n  c.FirstName\nHAVING\n  SUM(ii.UnitPrice * ii.Quantity) < 1;\t----- bird -----\tchinook_spider2",
    "32": "WITH artist_album_sales AS (\n  SELECT\n    ar.ArtistId,\n    ar.Name AS ArtistName,\n    SUM(ii.UnitPrice * ii.Quantity) AS TotalSales\n  FROM artists AS ar\n  INNER JOIN albums AS al\n    ON al.ArtistId = ar.ArtistId\n  INNER JOIN tracks AS t\n    ON t.AlbumId = al.AlbumId\n  INNER JOIN invoice_items AS ii\n    ON ii.TrackId = t.TrackId\n  GROUP BY ar.ArtistId, ar.Name\n),\ntop_artist AS (\n  SELECT ArtistId, ArtistName\n  FROM artist_album_sales\n  ORDER BY TotalSales DESC, ArtistName ASC\n  LIMIT 1\n),\nbottom_artist AS (\n  SELECT ArtistId, ArtistName\n  FROM artist_album_sales\n  ORDER BY TotalSales ASC, ArtistName ASC\n  LIMIT 1\n),\ncustomer_spend_top AS (\n  SELECT\n    i.CustomerId,\n    SUM(ii.UnitPrice * ii.Quantity) AS Spend\n  FROM top_artist ta\n  INNER JOIN albums al\n    ON al.ArtistId = ta.ArtistId\n  INNER JOIN tracks t\n    ON t.AlbumId = al.AlbumId\n  INNER JOIN invoice_items ii\n    ON ii.TrackId = t.TrackId\n  INNER JOIN invoices i\n    ON i.InvoiceId = ii.InvoiceId\n  GROUP BY i.CustomerId\n),\ncustomer_spend_bottom AS (\n  SELECT\n    i.CustomerId,\n    SUM(ii.UnitPrice * ii.Quantity) AS Spend\n  FROM bottom_artist ba\n  INNER JOIN albums al\n    ON al.ArtistId = ba.ArtistId\n  INNER JOIN tracks t\n    ON t.AlbumId = al.AlbumId\n  INNER JOIN invoice_items ii\n    ON ii.TrackId = t.TrackId\n  INNER JOIN invoices i\n    ON i.InvoiceId = ii.InvoiceId\n  GROUP BY i.CustomerId\n),\navg_top AS (\n  SELECT AVG(Spend) AS AvgSpendTop\n  FROM customer_spend_top\n),\navg_bottom AS (\n  SELECT AVG(Spend) AS AvgSpendBottom\n  FROM customer_spend_bottom\n)\nSELECT\n  ABS(avg_top.AvgSpendTop - avg_bottom.AvgSpendBottom) AS AbsDifferenceBetweenAverages\nFROM avg_top\nCROSS JOIN avg_bottom;\t----- bird -----\tchinook_spider2",
    "33": "WITH countries_over_4 AS (\n  SELECT\n    c.Country\n  FROM customers AS c\n  GROUP BY\n    c.Country\n  HAVING\n    COUNT(*) > 4\n),\ntotals_in_those_countries AS (\n  SELECT\n    i.Total\n  FROM invoices AS i\n  INNER JOIN customers AS c\n    ON i.CustomerId = c.CustomerId\n  INNER JOIN countries_over_4 AS co4\n    ON c.Country = co4.Country\n),\nordered_totals AS (\n  SELECT\n    Total,\n    ROW_NUMBER() OVER (ORDER BY Total) AS rn,\n    COUNT(*) OVER () AS cnt\n  FROM totals_in_those_countries\n)\nSELECT\n  AVG(Total) AS median_total_sales\nFROM ordered_totals\nWHERE rn IN ( (cnt + 1) / 2, (cnt + 2) / 2 );\t----- bird -----\tchinook_spider2",
    "34": "SELECT\n  c.first_name,\n  c.last_name\nFROM customer AS c\nINNER JOIN payment AS p\n  ON p.customer_id = c.customer_id\nGROUP BY\n  c.customer_id\nORDER BY\n  SUM(p.amount) DESC\nLIMIT 1;\t----- bird -----\tsqlite-sakila_spider2",
    "35": "SELECT\n  p.segment,\n  COUNT(DISTINCT CASE WHEN s.fiscal_year = 2020 THEN s.product_code END) AS unique_product_count_2020\nFROM hardware_fact_sales_monthly AS s\nINNER JOIN hardware_dim_product AS p\n  ON s.product_code = p.product_code\nGROUP BY\n  p.segment\nORDER BY\n  (\n    COUNT(DISTINCT CASE WHEN s.fiscal_year = 2021 THEN s.product_code END)\n    - COUNT(DISTINCT CASE WHEN s.fiscal_year = 2020 THEN s.product_code END)\n  ) DESC\nLIMIT 10;\t----- bird -----\teducation_business_spider2",
    "36": "WITH sales_2021 AS (\n  SELECT\n    p.division,\n    s.product_code,\n    s.sold_quantity\n  FROM hardware_fact_sales_monthly AS s\n  INNER JOIN hardware_dim_product AS p\n    ON s.product_code = p.product_code\n  WHERE s.date >= '2021-01-01'\n    AND s.date <  '2022-01-01'\n),\nproduct_totals AS (\n  SELECT\n    division,\n    product_code,\n    SUM(sold_quantity) AS total_qty\n  FROM sales_2021\n  GROUP BY division, product_code\n),\ntop3_per_division AS (\n  SELECT division, product_code\n  FROM (\n    SELECT\n      division,\n      product_code,\n      total_qty,\n      ROW_NUMBER() OVER (\n        PARTITION BY division\n        ORDER BY total_qty DESC\n      ) AS rn\n    FROM product_totals\n  )\n  WHERE rn <= 3\n)\nSELECT\n  AVG(s.sold_quantity) AS avg_quantity\nFROM sales_2021 AS s\nINNER JOIN top3_per_division AS t\n  ON s.division = t.division\n AND s.product_code = t.product_code;\t----- bird -----\teducation_business_spider2",
    "37": "WITH base_sales AS (\n  SELECT\n    c.cust_city,\n    p.prod_id,\n    p.prod_name,\n    t.calendar_year,\n    SUM(s.amount_sold) AS sales_amount\n  FROM sales AS s\n  INNER JOIN customers AS c\n    ON s.cust_id = c.cust_id\n  INNER JOIN countries AS co\n    ON c.country_id = co.country_id\n  INNER JOIN times AS t\n    ON s.time_id = t.time_id\n  INNER JOIN products AS p\n    ON s.prod_id = p.prod_id\n  WHERE\n    co.country_name = 'United States'\n    AND t.calendar_quarter_number = 4\n    AND t.calendar_year IN (2019, 2020)\n    AND s.promo_id IS NULL\n  GROUP BY\n    c.cust_city, p.prod_id, p.prod_name, t.calendar_year\n),\ncity_totals AS (\n  SELECT\n    cust_city,\n    SUM(CASE WHEN calendar_year = 2019 THEN sales_amount ELSE 0 END) AS sales_2019,\n    SUM(CASE WHEN calendar_year = 2020 THEN sales_amount ELSE 0 END) AS sales_2020\n  FROM base_sales\n  GROUP BY cust_city\n),\neligible_cities AS (\n  SELECT\n    cust_city\n  FROM city_totals\n  WHERE\n    sales_2019 > 0\n    AND (sales_2020 - sales_2019) * 1.0 / sales_2019 >= 0.20\n),\nproduct_totals AS (\n  SELECT\n    bs.prod_id,\n    bs.prod_name,\n    SUM(bs.sales_amount) AS total_sales_both_quarters\n  FROM base_sales AS bs\n  INNER JOIN eligible_cities AS ec\n    ON bs.cust_city = ec.cust_city\n  GROUP BY bs.prod_id, bs.prod_name\n),\nranked_products AS (\n  SELECT\n    prod_id,\n    prod_name,\n    total_sales_both_quarters,\n    PERCENT_RANK() OVER (ORDER BY total_sales_both_quarters DESC) AS pr\n  FROM product_totals\n),\ntop_products AS (\n  SELECT prod_id, prod_name\n  FROM ranked_products\n  WHERE pr <= 0.20\n),\ntop_product_city_year AS (\n  SELECT\n    bs.cust_city,\n    bs.prod_id,\n    bs.prod_name,\n    bs.calendar_year,\n    bs.sales_amount\n  FROM base_sales AS bs\n  INNER JOIN eligible_cities AS ec\n    ON bs.cust_city = ec.cust_city\n  INNER JOIN top_products AS tp\n    ON bs.prod_id = tp.prod_id\n),\ncity_year_totals AS (\n  SELECT\n    cust_city,\n    calendar_year,\n    SUM(sales_amount) AS city_year_total_sales\n  FROM base_sales\n  WHERE cust_city IN (SELECT cust_city FROM eligible_cities)\n  GROUP BY cust_city, calendar_year\n),\nshares AS (\n  SELECT\n    tpc.cust_city,\n    tpc.prod_id,\n    tpc.prod_name,\n    SUM(CASE WHEN tpc.calendar_year = 2019 THEN tpc.sales_amount ELSE 0 END) AS prod_sales_2019,\n    SUM(CASE WHEN tpc.calendar_year = 2020 THEN tpc.sales_amount ELSE 0 END) AS prod_sales_2020,\n    MAX(CASE WHEN cyt.calendar_year = 2019 THEN cyt.city_year_total_sales END) AS city_total_2019,\n    MAX(CASE WHEN cyt.calendar_year = 2020 THEN cyt.city_year_total_sales END) AS city_total_2020\n  FROM top_product_city_year AS tpc\n  INNER JOIN city_year_totals AS cyt\n    ON tpc.cust_city = cyt.cust_city\n   AND tpc.calendar_year = cyt.calendar_year\n  GROUP BY\n    tpc.cust_city, tpc.prod_id, tpc.prod_name\n)\nSELECT\n  cust_city,\n  prod_name,\n  (prod_sales_2019 * 1.0 / NULLIF(city_total_2019, 0)) AS share_q4_2019,\n  (prod_sales_2020 * 1.0 / NULLIF(city_total_2020, 0)) AS share_q4_2020,\n  (prod_sales_2020 * 1.0 / NULLIF(city_total_2020, 0))\n  - (prod_sales_2019 * 1.0 / NULLIF(city_total_2019, 0)) AS share_change\nFROM shares\nORDER BY share_change DESC;\t----- bird -----\tcomplex_oracle_spider2",
    "38": "WITH base AS (\n  SELECT\n    s.amount_sold,\n    s.promo_id,\n    t.calendar_quarter_id,\n    c.cust_city,\n    c.country_id,\n    p.prod_id,\n    p.prod_name\n  FROM sales AS s\n  INNER JOIN customers AS c ON s.cust_id = c.cust_id\n  INNER JOIN times AS t ON s.time_id = t.time_id\n  INNER JOIN products AS p ON s.prod_id = p.prod_id\n  INNER JOIN countries AS co ON c.country_id = co.country_id\n  WHERE s.promo_id = 999\n    AND co.country_name = 'United States'\n    AND t.calendar_quarter_id IN (1772, 1776)\n),\ncity_sales AS (\n  SELECT\n    cust_city,\n    SUM(CASE WHEN calendar_quarter_id = 1772 THEN amount_sold ELSE 0 END) AS sales_2019q4,\n    SUM(CASE WHEN calendar_quarter_id = 1776 THEN amount_sold ELSE 0 END) AS sales_2020q4\n  FROM base\n  GROUP BY cust_city\n),\neligible_cities AS (\n  SELECT cust_city\n  FROM city_sales\n  WHERE sales_2019q4 > 0\n    AND (sales_2020q4 - sales_2019q4) * 1.0 / sales_2019q4 >= 0.20\n),\nbase_ec AS (\n  SELECT b.*\n  FROM base AS b\n  INNER JOIN eligible_cities AS ec ON b.cust_city = ec.cust_city\n),\ntotals AS (\n  SELECT\n    calendar_quarter_id,\n    SUM(amount_sold) AS total_sales\n  FROM base_ec\n  GROUP BY calendar_quarter_id\n),\nprod_qtr AS (\n  SELECT\n    prod_id,\n    prod_name,\n    calendar_quarter_id,\n    SUM(amount_sold) AS prod_sales\n  FROM base_ec\n  GROUP BY prod_id, prod_name, calendar_quarter_id\n),\nprod_pivot AS (\n  SELECT\n    prod_id,\n    prod_name,\n    SUM(CASE WHEN calendar_quarter_id = 1772 THEN prod_sales ELSE 0 END) AS prod_sales_2019q4,\n    SUM(CASE WHEN calendar_quarter_id = 1776 THEN prod_sales ELSE 0 END) AS prod_sales_2020q4\n  FROM prod_qtr\n  GROUP BY prod_id, prod_name\n),\nshares AS (\n  SELECT\n    pp.prod_id,\n    pp.prod_name,\n    pp.prod_sales_2019q4,\n    pp.prod_sales_2020q4,\n    (pp.prod_sales_2019q4 * 1.0 / t19.total_sales) * 100.0 AS share_2019q4,\n    (pp.prod_sales_2020q4 * 1.0 / t20.total_sales) * 100.0 AS share_2020q4,\n    (pp.prod_sales_2019q4 + pp.prod_sales_2020q4) AS total_two_qtrs\n  FROM prod_pivot AS pp\n  INNER JOIN totals AS t19 ON t19.calendar_quarter_id = 1772\n  INNER JOIN totals AS t20 ON t20.calendar_quarter_id = 1776\n),\ntop20 AS (\n  SELECT\n    s.*,\n    NTILE(5) OVER (ORDER BY total_two_qtrs DESC) AS sales_quintile\n  FROM shares AS s\n)\nSELECT prod_name\nFROM top20\nWHERE sales_quintile = 1\nORDER BY ABS(share_2020q4 - share_2019q4) ASC\nLIMIT 1;\t----- bird -----\tcomplex_oracle_spider2",
    "39": "WITH sales_2019 AS (\n  SELECT\n    s.prod_id,\n    t.calendar_month_number AS month_num,\n    SUM(s.amount_sold) AS amt_2019\n  FROM sales AS s\n  INNER JOIN customers AS cu ON s.cust_id = cu.cust_id\n  INNER JOIN countries AS co ON cu.country_id = co.country_id\n  INNER JOIN promotions AS p ON s.promo_id = p.promo_id\n  INNER JOIN channels AS ch ON s.channel_id = ch.channel_id\n  INNER JOIN times AS t ON s.time_id = t.time_id\n  WHERE co.country_name = 'France'\n    AND p.promo_total_id = 1\n    AND ch.channel_total_id = 1\n    AND t.calendar_year = 2019\n  GROUP BY s.prod_id, t.calendar_month_number\n),\nsales_2020 AS (\n  SELECT\n    s.prod_id,\n    t.calendar_month_number AS month_num,\n    SUM(s.amount_sold) AS amt_2020\n  FROM sales AS s\n  INNER JOIN customers AS cu ON s.cust_id = cu.cust_id\n  INNER JOIN countries AS co ON cu.country_id = co.country_id\n  INNER JOIN promotions AS p ON s.promo_id = p.promo_id\n  INNER JOIN channels AS ch ON s.channel_id = ch.channel_id\n  INNER JOIN times AS t ON s.time_id = t.time_id\n  WHERE co.country_name = 'France'\n    AND p.promo_total_id = 1\n    AND ch.channel_total_id = 1\n    AND t.calendar_year = 2020\n  GROUP BY s.prod_id, t.calendar_month_number\n),\nproj_2021_local AS (\n  SELECT\n    s20.prod_id,\n    s20.month_num,\n    (\n      ((s20.amt_2020 - s19.amt_2019) * 1.0 / NULLIF(s19.amt_2019, 0)) * s20.amt_2020\n      + s20.amt_2020\n    ) AS projected_2021_amount_local\n  FROM sales_2020 AS s20\n  INNER JOIN sales_2019 AS s19\n    ON s19.prod_id = s20.prod_id\n   AND s19.month_num = s20.month_num\n),\nproj_2021_usd AS (\n  SELECT\n    p.month_num,\n    p.projected_2021_amount_local * COALESCE(cur.to_us, 1) AS projected_2021_amount_usd\n  FROM proj_2021_local AS p\n  LEFT JOIN currency AS cur\n    ON cur.country = 'France'\n   AND cur.year = 2021\n   AND cur.month = p.month_num\n)\nSELECT\n  month_num AS calendar_month_number,\n  ROUND(AVG(projected_2021_amount_usd), 2) AS avg_projected_monthly_sales_usd\nFROM proj_2021_usd\nGROUP BY month_num\nORDER BY month_num;\t----- bird -----\tcomplex_oracle_spider2",
    "40": "WITH monthly_sales AS (\n  SELECT\n    c.country_name,\n    t.calendar_year AS year,\n    t.calendar_month_number AS month,\n    SUM(s.amount_sold) AS sales_amount\n  FROM sales AS s\n  INNER JOIN customers AS cu\n    ON s.cust_id = cu.cust_id\n  INNER JOIN countries AS c\n    ON cu.country_id = c.country_id\n  INNER JOIN times AS t\n    ON s.time_id = t.time_id\n  INNER JOIN promotions AS p\n    ON s.promo_id = p.promo_id\n  INNER JOIN channels AS ch\n    ON s.channel_id = ch.channel_id\n  WHERE c.country_name = 'France'\n    AND t.calendar_year IN (2019, 2020)\n    AND p.promo_total_id = 1\n    AND ch.channel_total_id = 1\n  GROUP BY\n    c.country_name, t.calendar_year, t.calendar_month_number\n),\nproj_2021 AS (\n  SELECT\n    ms20.month,\n    (\n      ((ms20.sales_amount - ms19.sales_amount) * 1.0 / NULLIF(ms19.sales_amount, 0)) * ms20.sales_amount\n      + ms20.sales_amount\n    ) AS projected_sales_2021\n  FROM monthly_sales AS ms19\n  INNER JOIN monthly_sales AS ms20\n    ON ms19.country_name = ms20.country_name\n   AND ms19.month = ms20.month\n   AND ms19.year = 2019\n   AND ms20.year = 2020\n),\nproj_2021_usd AS (\n  SELECT\n    p.month,\n    p.projected_sales_2021 * COALESCE(cur.to_us, 1) AS projected_sales_2021_usd\n  FROM proj_2021 AS p\n  LEFT JOIN currency AS cur\n    ON cur.country = 'France'\n   AND cur.year = 2021\n   AND cur.month = p.month\n),\nordered AS (\n  SELECT\n    projected_sales_2021_usd,\n    ROW_NUMBER() OVER (ORDER BY projected_sales_2021_usd) AS rn,\n    COUNT(*) OVER () AS cnt\n  FROM proj_2021_usd\n)\nSELECT\n  AVG(projected_sales_2021_usd) AS median_avg_monthly_projected_sales_usd\nFROM ordered\nWHERE rn IN ( (cnt + 1) / 2, (cnt + 2) / 2 );\t----- bird -----\tcomplex_oracle_spider2",
    "41": "WITH cust_profit AS (\n  SELECT\n    s.cust_id,\n    SUM(\n      s.quantity_sold * (c.unit_price - c.unit_cost)\n    ) AS total_profit\n  FROM sales AS s\n  INNER JOIN customers AS cu\n    ON s.cust_id = cu.cust_id\n  INNER JOIN countries AS co\n    ON cu.country_id = co.country_id\n  INNER JOIN costs AS c\n    ON s.prod_id = c.prod_id\n   AND s.time_id = c.time_id\n   AND s.channel_id = c.channel_id\n   AND s.promo_id = c.promo_id\n  INNER JOIN times AS t\n    ON s.time_id = t.time_id\n  WHERE co.country_name = 'Italy'\n    AND t.calendar_year = 2021\n    AND t.calendar_month_number = 12\n  GROUP BY s.cust_id\n),\nbounds AS (\n  SELECT\n    MIN(total_profit) AS min_profit,\n    MAX(total_profit) AS max_profit\n  FROM cust_profit\n),\nbucketed AS (\n  SELECT\n    cp.cust_id,\n    cp.total_profit,\n    CASE\n      WHEN b.max_profit = b.min_profit THEN 1\n      ELSE\n        CAST(\n          FLOOR(\n            (cp.total_profit - b.min_profit) * 10.0 / (b.max_profit - b.min_profit)\n          ) AS INTEGER\n        ) + 1\n    END AS bucket\n  FROM cust_profit AS cp\n  CROSS JOIN bounds AS b\n)\nSELECT\n  bucket,\n  COUNT(*) AS num_customers,\n  MIN(total_profit) AS min_total_profit,\n  MAX(total_profit) AS max_total_profit\nFROM bucketed\nWHERE bucket BETWEEN 1 AND 10\nGROUP BY bucket\nORDER BY bucket;\t----- bird -----\tcomplex_oracle_spider2",
    "42": "WITH customer_profits AS (\n  SELECT\n    c.cust_id,\n    SUM(s.amount_sold - co.unit_cost * s.quantity_sold) AS profit\n  FROM sales AS s\n  INNER JOIN customers AS c\n    ON s.cust_id = c.cust_id\n  INNER JOIN countries AS cn\n    ON c.country_id = cn.country_id\n  INNER JOIN times AS t\n    ON s.time_id = t.time_id\n  INNER JOIN costs AS co\n    ON co.prod_id = s.prod_id\n   AND co.time_id = s.time_id\n   AND co.channel_id = s.channel_id\n   AND co.promo_id = s.promo_id\n  WHERE cn.country_name = 'Italy'\n    AND t.calendar_month_name = 'December'\n    AND t.fiscal_year = 2021\n  GROUP BY c.cust_id\n)\nSELECT\n  MAX(profit) AS highest_profit,\n  MIN(profit) AS lowest_profit\nFROM customer_profits;\t----- bird -----\tcomplex_oracle_spider2",
    "43": "WITH base AS (\n  SELECT\n    ldd.date AS dt,\n    MIN(c.city_name) AS city_name\n  FROM cities AS c\n  INNER JOIN legislation_date_dim AS ldd\n    ON DATE(c.insert_date) = ldd.date\n  WHERE c.country_code_2 = 'cn'\n    AND ldd.month_name = 'July'\n    AND ldd.date >= '2021-07-01'\n    AND ldd.date <  '2021-08-01'\n  GROUP BY ldd.date\n),\nseq AS (\n  SELECT\n    dt,\n    city_name,\n    julianday(dt) - ROW_NUMBER() OVER (ORDER BY dt) AS grp\n  FROM base\n),\nstreaks AS (\n  SELECT\n    grp,\n    MIN(dt) AS start_dt,\n    MAX(dt) AS end_dt,\n    COUNT(*) AS len\n  FROM seq\n  GROUP BY grp\n),\nbounds AS (\n  SELECT start_dt, end_dt, len\n  FROM streaks\n  WHERE len = (SELECT MIN(len) FROM streaks)\n  UNION ALL\n  SELECT start_dt, end_dt, len\n  FROM streaks\n  WHERE len = (SELECT MAX(len) FROM streaks)\n)\nSELECT\n  s.dt AS date,\n  UPPER(SUBSTR(s.city_name, 1, 1)) || LOWER(SUBSTR(s.city_name, 2)) AS city_name\nFROM seq AS s\nINNER JOIN bounds AS b\n  ON s.dt BETWEEN b.start_dt AND b.end_dt\nORDER BY s.dt;\t----- bird -----\tcity_legislation_spider2",
    "44": "SELECT\n  cities.country_code_2\nFROM cities\nWHERE cities.insert_date BETWEEN '2022-06-01' AND '2022-06-30'\nGROUP BY cities.country_code_2\nORDER BY COUNT(cities.insert_date) DESC\nLIMIT 2;\t----- bird -----\tcity_legislation_spider2",
    "45": "WITH jan AS (\n  SELECT\n    c.country_code_2,\n    c.insert_date,\n    c.capital\n  FROM cities AS c\n  WHERE c.insert_date BETWEEN '2022-01-01' AND '2022-01-31'\n),\ncountry_9_days AS (\n  SELECT\n    j.country_code_2\n  FROM jan AS j\n  GROUP BY j.country_code_2\n  HAVING COUNT(DISTINCT j.insert_date) = 9\n  LIMIT 1\n),\ncountry_jan AS (\n  SELECT\n    j.*\n  FROM jan AS j\n  INNER JOIN country_9_days AS t\n    ON j.country_code_2 = t.country_code_2\n),\ndaily AS (\n  SELECT\n    country_code_2,\n    insert_date,\n    SUM(CASE WHEN LOWER(capital) = 'yes' THEN 1 ELSE 0 END) AS capital_cnt,\n    COUNT(*) AS total_cnt\n  FROM country_jan\n  GROUP BY country_code_2, insert_date\n),\nruns AS (\n  SELECT\n    d.*,\n    (julianday(d.insert_date) - ROW_NUMBER() OVER (\n       PARTITION BY d.country_code_2\n       ORDER BY d.insert_date\n     )) AS grp\n  FROM daily AS d\n),\nrun_stats AS (\n  SELECT\n    country_code_2,\n    grp,\n    MIN(insert_date) AS start_date,\n    MAX(insert_date) AS end_date,\n    COUNT(*) AS consecutive_days,\n    SUM(capital_cnt) AS capital_entries,\n    SUM(total_cnt) AS total_entries\n  FROM runs\n  GROUP BY country_code_2, grp\n),\nbest_run AS (\n  SELECT *\n  FROM run_stats\n  ORDER BY consecutive_days DESC, start_date ASC\n  LIMIT 1\n)\nSELECT\n  cc.country_name,\n  1.0 * br.capital_entries / br.total_entries AS capital_entry_proportion\nFROM best_run AS br\nINNER JOIN cities_countries AS cc\n  ON cc.country_code_2 = br.country_code_2;\t----- bird -----\tcity_legislation_spider2",
    "46": "WITH base AS (\n  SELECT\n    CAST(strftime('%Y', c.insert_date) AS INTEGER) AS year,\n    UPPER(ld.month_name) AS month_name,\n    COUNT(*) AS monthly_total\n  FROM cities AS c\n  INNER JOIN legislation_date_dim AS ld\n    ON date(c.insert_date) = ld.date\n  WHERE CAST(strftime('%Y', c.insert_date) AS INTEGER) BETWEEN 2021 AND 2023\n    AND UPPER(ld.month_name) IN ('APRIL', 'MAY', 'JUNE')\n  GROUP BY\n    CAST(strftime('%Y', c.insert_date) AS INTEGER),\n    UPPER(ld.month_name)\n),\ncalc AS (\n  SELECT\n    year,\n    month_name,\n    monthly_total,\n    SUM(monthly_total) OVER (\n      PARTITION BY month_name\n      ORDER BY year\n      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) AS running_total,\n    LAG(monthly_total) OVER (\n      PARTITION BY month_name\n      ORDER BY year\n    ) AS prev_monthly_total,\n    LAG(\n      SUM(monthly_total) OVER (\n        PARTITION BY month_name\n        ORDER BY year\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n      )\n    ) OVER (\n      PARTITION BY month_name\n      ORDER BY year\n    ) AS prev_running_total\n  FROM base\n)\nSELECT\n  year,\n  month_name,\n  monthly_total AS total_cities_added,\n  running_total AS cumulative_running_total,\n  CASE\n    WHEN prev_monthly_total IS NULL OR prev_monthly_total = 0 THEN NULL\n    ELSE (monthly_total - prev_monthly_total) * 100.0 / prev_monthly_total\n  END AS yoy_growth_monthly_total_pct,\n  CASE\n    WHEN prev_running_total IS NULL OR prev_running_total = 0 THEN NULL\n    ELSE (running_total - prev_running_total) * 100.0 / prev_running_total\n  END AS yoy_growth_running_total_pct\nFROM calc\nWHERE year IN (2022, 2023)\nORDER BY\n  month_name,\n  year;\t----- bird -----\tcity_legislation_spider2",
    "47": "WITH base AS (\n  SELECT\n    cco.row_id,\n    cco.order_id,\n    cco.customer_id,\n    cco.pizza_id,\n    cco.order_time,\n    pn.pizza_name\n  FROM pizza_clean_customer_orders AS cco\n  INNER JOIN pizza_names AS pn\n    ON pn.pizza_id = cco.pizza_id\n),\n-- standard recipe toppings (one row per topping)\nstd AS (\n  SELECT\n    b.row_id,\n    b.order_id,\n    b.customer_id,\n    b.pizza_id,\n    b.order_time,\n    b.pizza_name,\n    CAST(j.value AS INTEGER) AS topping_id\n  FROM base AS b\n  INNER JOIN pizza_recipes AS pr\n    ON pr.pizza_id = b.pizza_id\n  INNER JOIN json_each(\n    '[\"' || REPLACE(pr.toppings, ',', '\",\"') || '\"]'\n  ) AS j\n),\n-- exclusions (one row per excluded topping)\nexc AS (\n  SELECT\n    b.row_id,\n    CAST(j.value AS INTEGER) AS topping_id\n  FROM base AS b\n  INNER JOIN pizza_get_exclusions AS pge\n    ON pge.row_id = b.row_id\n  INNER JOIN json_each(\n    '[\"' || REPLACE(pge.exclusions, ',', '\",\"') || '\"]'\n  ) AS j\n  WHERE pge.exclusions IS NOT NULL\n    AND TRIM(pge.exclusions) <> ''\n),\n-- extras (one row per extra topping)\next AS (\n  SELECT\n    b.row_id,\n    CAST(j.value AS INTEGER) AS topping_id\n  FROM base AS b\n  INNER JOIN pizza_get_extras AS pxx\n    ON pxx.row_id = b.row_id\n  INNER JOIN json_each(\n    '[\"' || REPLACE(pxx.extras, ',', '\",\"') || '\"]'\n  ) AS j\n  WHERE pxx.extras IS NOT NULL\n    AND TRIM(pxx.extras) <> ''\n),\n-- final toppings = (standard minus exclusions) union (extras)\nfinal_toppings AS (\n  SELECT s.row_id, s.order_id, s.customer_id, s.pizza_id, s.order_time, s.pizza_name, s.topping_id\n  FROM std AS s\n  LEFT JOIN exc AS e\n    ON e.row_id = s.row_id AND e.topping_id = s.topping_id\n  WHERE e.topping_id IS NULL\n\n  UNION ALL\n\n  SELECT b.row_id, b.order_id, b.customer_id, b.pizza_id, b.order_time, b.pizza_name, x.topping_id\n  FROM base AS b\n  INNER JOIN ext AS x\n    ON x.row_id = b.row_id\n),\ntopping_counts AS (\n  SELECT\n    ft.row_id,\n    ft.order_id,\n    ft.customer_id,\n    ft.pizza_id,\n    ft.order_time,\n    ft.pizza_name,\n    t.topping_name,\n    COUNT(*) AS cnt\n  FROM final_toppings AS ft\n  INNER JOIN pizza_toppings AS t\n    ON t.topping_id = ft.topping_id\n  GROUP BY\n    ft.row_id, ft.order_id, ft.customer_id, ft.pizza_id, ft.order_time, ft.pizza_name, t.topping_name\n)\nSELECT\n  tc.row_id,\n  tc.order_id,\n  tc.customer_id,\n  tc.pizza_name,\n  tc.pizza_name || ': ' ||\n  GROUP_CONCAT(\n    CASE WHEN tc.cnt >= 2 THEN '2x' || tc.topping_name ELSE tc.topping_name END,\n    ', '\n  ) AS ingredients\nFROM (\n  SELECT\n    tc.*,\n    CASE WHEN tc.cnt >= 2 THEN 0 ELSE 1 END AS grp_sort\n  FROM topping_counts AS tc\n) AS tc\nGROUP BY\n  tc.row_id, tc.order_id, tc.customer_id, tc.pizza_name, tc.order_time\nORDER BY\n  tc.row_id ASC;\t----- bird -----\tmodern_data_spider2",
    "48": "SELECT\n  pt.topping_name,\n  COUNT(*) AS quantity\nFROM pizza_clean_customer_orders AS cco\nINNER JOIN pizza_clean_runner_orders AS cro\n  ON cco.order_id = cro.order_id\nINNER JOIN pizza_recipes AS pr\n  ON cco.pizza_id = pr.pizza_id\nINNER JOIN pizza_toppings AS pt\n  ON pr.toppings = pt.topping_id\nWHERE cro.cancellation IS NULL\nGROUP BY pt.topping_name;\t----- bird -----\tmodern_data_spider2",
    "49": "SELECT\n  SUM(\n    CASE\n      WHEN pn.pizza_name = 'Meatlovers' THEN 12\n      WHEN pn.pizza_name = 'Vegetarian' THEN 10\n      ELSE 0\n    END\n    + COALESCE(pge.extras_count, 0) * 1\n  ) AS total_income\nFROM pizza_runner_orders AS pro\nINNER JOIN pizza_clean_customer_orders AS pcco\n  ON pcco.order_id = pro.order_id\nINNER JOIN pizza_names AS pn\n  ON pn.pizza_id = pcco.pizza_id\nLEFT JOIN pizza_get_extras AS pge\n  ON pge.order_id = pro.order_id\nWHERE pro.cancellation IS NULL\n  AND pn.pizza_name IN ('Meatlovers', 'Vegetarian');\t----- bird -----\tmodern_data_spider2",
    "50": "WITH monthly_txn AS (\n  SELECT\n    customer_id,\n    date(txn_date, 'start of month') AS month_start,\n    SUM(txn_amount) AS monthly_change\n  FROM customer_transactions\n  GROUP BY\n    customer_id,\n    date(txn_date, 'start of month')\n),\nbounds AS (\n  SELECT\n    MIN(date(txn_date, 'start of month')) AS min_month,\n    MAX(date(txn_date, 'start of month')) AS max_month\n  FROM customer_transactions\n),\nmonths AS (\n  SELECT min_month AS month_start\n  FROM bounds\n  UNION ALL\n  SELECT date(month_start, '+1 month')\n  FROM months, bounds\n  WHERE month_start < max_month\n),\ncustomers AS (\n  SELECT DISTINCT customer_id\n  FROM customer_transactions\n),\ncustomer_months AS (\n  SELECT\n    c.customer_id,\n    m.month_start\n  FROM customers c\n  INNER JOIN months m\n),\nfilled AS (\n  SELECT\n    cm.customer_id,\n    cm.month_start,\n    COALESCE(mt.monthly_change, 0) AS monthly_change\n  FROM customer_months cm\n  LEFT JOIN monthly_txn mt\n    ON mt.customer_id = cm.customer_id\n   AND mt.month_start = cm.month_start\n)\nSELECT\n  customer_id,\n  month_start AS txn_date,\n  monthly_change,\n  SUM(monthly_change) OVER (\n    PARTITION BY customer_id\n    ORDER BY month_start\n    ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n  ) AS closing_balance\nFROM filled\nORDER BY\n  customer_id,\n  month_start;\t----- bird -----\tbank_sales_trading_spider2",
    "51": "WITH monthly_balances AS (\n  SELECT\n    customer_id,\n    strftime('%Y-%m', txn_date) AS ym,\n    SUM(\n      CASE\n        WHEN lower(txn_type) = 'deposit' THEN txn_amount\n        WHEN lower(txn_type) = 'withdrawal' THEN -txn_amount\n        ELSE 0\n      END\n    ) AS month_end_balance\n  FROM customer_transactions\n  WHERE txn_date >= '2020-01-01'\n    AND txn_date <  '2021-01-01'\n  GROUP BY customer_id, ym\n),\nmonth_stats AS (\n  SELECT\n    ym,\n    COUNT(CASE WHEN month_end_balance > 0 THEN 1 END) AS positive_customer_count,\n    AVG(month_end_balance) AS avg_month_end_balance\n  FROM monthly_balances\n  GROUP BY ym\n),\nextremes AS (\n  SELECT\n    (SELECT ym\n     FROM month_stats\n     ORDER BY positive_customer_count DESC, ym\n     LIMIT 1) AS max_month,\n    (SELECT ym\n     FROM month_stats\n     ORDER BY positive_customer_count ASC, ym\n     LIMIT 1) AS min_month\n)\nSELECT\n  e.max_month AS highest_count_month,\n  ms_max.positive_customer_count AS highest_count_positive_customers,\n  ms_max.avg_month_end_balance AS highest_count_month_avg_balance,\n  e.min_month AS lowest_count_month,\n  ms_min.positive_customer_count AS lowest_count_positive_customers,\n  ms_min.avg_month_end_balance AS lowest_count_month_avg_balance,\n  (ms_max.avg_month_end_balance - ms_min.avg_month_end_balance) AS avg_balance_difference\nFROM extremes e\nINNER JOIN month_stats ms_max ON ms_max.ym = e.max_month\nINNER JOIN month_stats ms_min ON ms_min.ym = e.min_month;\t----- bird -----\tbank_sales_trading_spider2",
    "52": "WITH monthly_net AS (\n  SELECT\n    customer_id,\n    date(txn_date, 'start of month') AS month_start,\n    SUM(\n      CASE\n        WHEN lower(txn_type) = 'deposit' THEN txn_amount\n        WHEN lower(txn_type) = 'withdrawal' THEN -txn_amount\n        ELSE 0\n      END\n    ) AS net_amount\n  FROM customer_transactions\n  GROUP BY customer_id, date(txn_date, 'start of month')\n),\nmonthly_balance AS (\n  SELECT\n    customer_id,\n    month_start,\n    SUM(net_amount) OVER (\n      PARTITION BY customer_id\n      ORDER BY month_start\n      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) AS closing_balance\n  FROM monthly_net\n),\nlatest_two AS (\n  SELECT\n    customer_id,\n    month_start,\n    closing_balance,\n    LAG(closing_balance) OVER (\n      PARTITION BY customer_id\n      ORDER BY month_start\n    ) AS prev_closing_balance,\n    ROW_NUMBER() OVER (\n      PARTITION BY customer_id\n      ORDER BY month_start DESC\n    ) AS rn\n  FROM monthly_balance\n),\nlatest_growth AS (\n  SELECT\n    customer_id,\n    CASE\n      WHEN prev_closing_balance IS NULL THEN NULL\n      WHEN prev_closing_balance = 0 THEN closing_balance * 100.0\n      ELSE (closing_balance - prev_closing_balance) * 100.0 / prev_closing_balance\n    END AS growth_rate\n  FROM latest_two\n  WHERE rn = 1\n)\nSELECT\n  100.0 * SUM(CASE WHEN growth_rate > 5 THEN 1 ELSE 0 END) / COUNT(*) AS pct_customers_growth_gt_5\nFROM latest_growth\nWHERE growth_rate IS NOT NULL;\t----- bird -----\tbank_sales_trading_spider2",
    "53": "WITH monthly_net AS (\n  SELECT\n    date(txn_date, 'start of month') AS month_start,\n    SUM(\n      CASE\n        WHEN txn_type = 'buy'  THEN quantity\n        WHEN txn_type = 'sell' THEN -quantity\n        ELSE 0\n      END\n    ) AS net_change\n  FROM bitcoin_transactions\n  WHERE txn_date >= '2022-01-01'\n  GROUP BY date(txn_date, 'start of month')\n),\nmonthly_balance AS (\n  SELECT\n    month_start,\n    SUM(net_change) OVER (\n      ORDER BY month_start\n      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) AS balance_as_of_month_start\n  FROM monthly_net\n),\nprev_month_total AS (\n  SELECT\n    month_start,\n    LAG(balance_as_of_month_start) OVER (ORDER BY month_start) AS prev_balance\n  FROM monthly_balance\n)\nSELECT\n  month_start AS month,\n  CASE\n    WHEN prev_balance < 0 THEN 0\n    ELSE prev_balance\n  END AS total_balance_previous_month\nFROM prev_month_total\nWHERE prev_balance IS NOT NULL\nORDER BY month_start ASC;\t----- bird -----\tbank_sales_trading_spider2",
    "54": "WITH daily_net AS (\n  SELECT\n    customer_id,\n    DATE(txn_date) AS txn_day,\n    SUM(\n      CASE\n        WHEN LOWER(txn_type) = 'deposit' THEN txn_amount\n        ELSE -txn_amount\n      END\n    ) AS net_change\n  FROM customer_transactions\n  GROUP BY customer_id, DATE(txn_date)\n),\ndaily_balance AS (\n  SELECT\n    customer_id,\n    txn_day,\n    SUM(net_change) OVER (\n      PARTITION BY customer_id\n      ORDER BY txn_day\n      ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n    ) AS running_balance\n  FROM daily_net\n),\navg30 AS (\n  SELECT\n    customer_id,\n    txn_day,\n    running_balance,\n    CASE\n      WHEN COUNT(*) OVER (\n        PARTITION BY customer_id\n        ORDER BY txn_day\n        ROWS BETWEEN 29 PRECEDING AND CURRENT ROW\n      ) = 30\n      THEN\n        CASE\n          WHEN AVG(running_balance) OVER (\n            PARTITION BY customer_id\n            ORDER BY txn_day\n            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW\n          ) < 0\n          THEN 0\n          ELSE AVG(running_balance) OVER (\n            PARTITION BY customer_id\n            ORDER BY txn_day\n            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW\n          )\n        END\n      ELSE NULL\n    END AS avg_balance_30d\n  FROM daily_balance\n),\nmonthly_max AS (\n  SELECT\n    customer_id,\n    strftime('%Y-%m', txn_day) AS ym,\n    MAX(avg_balance_30d) AS max_avg_balance_30d\n  FROM avg30\n  WHERE avg_balance_30d IS NOT NULL\n  GROUP BY customer_id, strftime('%Y-%m', txn_day)\n),\nbaseline_month AS (\n  SELECT\n    customer_id,\n    MIN(ym) AS baseline_ym\n  FROM monthly_max\n  GROUP BY customer_id\n)\nSELECT\n  m.ym AS month,\n  SUM(m.max_avg_balance_30d) AS monthly_total_summed_max_30d_avg_balance\nFROM monthly_max AS m\nINNER JOIN baseline_month AS b\n  ON m.customer_id = b.customer_id\nWHERE m.ym <> b.baseline_ym\nGROUP BY m.ym\nORDER BY m.ym;\t----- bird -----\tbank_sales_trading_spider2",
    "55": "WITH\n-- 1) Daily net change per customer per day\ndaily_txn AS (\n  SELECT\n    customer_id,\n    DATE(txn_date) AS d,\n    SUM(\n      CASE\n        WHEN txn_type = 'deposit' THEN txn_amount\n        WHEN txn_type = 'withdrawal' THEN -txn_amount\n        ELSE 0\n      END\n    ) AS net_change\n  FROM customer_transactions\n  GROUP BY customer_id, DATE(txn_date)\n),\n\n-- 2) Per-customer date bounds\nbounds AS (\n  SELECT\n    customer_id,\n    MIN(d) AS min_d,\n    MAX(d) AS max_d\n  FROM daily_txn\n  GROUP BY customer_id\n),\n\n-- 3) Calendar of all days between min and max per customer\ncalendar AS (\n  SELECT customer_id, min_d AS d, max_d\n  FROM bounds\n  UNION ALL\n  SELECT customer_id, DATE(d, '+1 day') AS d, max_d\n  FROM calendar\n  WHERE d < max_d\n),\n\n-- 4) Daily balance by carrying forward (cumulative sum over calendar)\ndaily_balance AS (\n  SELECT\n    c.customer_id,\n    c.d,\n    MAX(\n      0,\n      SUM(COALESCE(dt.net_change, 0)) OVER (\n        PARTITION BY c.customer_id\n        ORDER BY c.d\n        ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n      )\n    ) AS balance\n  FROM calendar c\n  LEFT JOIN daily_txn dt\n    ON dt.customer_id = c.customer_id\n   AND dt.d = c.d\n),\n\n-- 5) For each customer and month, take the maximum daily balance in that month\ncustomer_month_max AS (\n  SELECT\n    customer_id,\n    STRFTIME('%Y-%m', d) AS month,\n    MAX(balance) AS max_daily_balance\n  FROM daily_balance\n  GROUP BY customer_id, STRFTIME('%Y-%m', d)\n)\n\n-- 6) Sum customer monthly maxima to get monthly total\nSELECT\n  month,\n  SUM(max_daily_balance) AS monthly_total\nFROM customer_month_max\nGROUP BY month\nORDER BY month\n;\t----- bird -----\tbank_sales_trading_spider2",
    "56": "SELECT\n  sch.product_id,\n  SUM(CASE WHEN sch.page_name = 'Product Page' THEN 1 ELSE 0 END) AS viewed,\n  SUM(CASE WHEN sei.event_name = 'Add to Cart' THEN 1 ELSE 0 END) AS added_to_cart,\n  SUM(CASE WHEN sei.event_name = 'Abandoned' THEN 1 ELSE 0 END) AS left_in_cart_without_purchase,\n  SUM(CASE WHEN sei.event_name = 'Purchase' THEN 1 ELSE 0 END) AS purchases\nFROM shopping_cart_page_hierarchy AS sch\nINNER JOIN shopping_cart_events AS sce\n  ON sch.page_id = sce.page_id\nINNER JOIN shopping_cart_event_identifier AS sei\n  ON sce.event_type = sei.event_type\nWHERE sch.page_id NOT IN (1, 2, 12, 13)\nGROUP BY sch.product_id;\t----- bird -----\tbank_sales_trading_spider2",
    "57": "WITH base AS (\n  SELECT\n    im._year,\n    im._month,\n    im.interest_id,\n    m.interest_name,\n    im.composition,\n    im.index_value\n  FROM interest_metrics AS im\n  INNER JOIN interest_map AS m\n    ON m.id = im.interest_id\n  WHERE\n    (im._year = 2018 AND im._month IN (9, 10, 11, 12))\n    OR\n    (im._year = 2019 AND im._month IN (1, 2, 3, 4, 5, 6, 7, 8))\n),\nmonthly_interest_avg AS (\n  SELECT\n    _year,\n    _month,\n    interest_id,\n    interest_name,\n    1.0 * SUM(composition) / NULLIF(SUM(index_value), 0) AS avg_composition\n  FROM base\n  GROUP BY _year, _month, interest_id, interest_name\n),\nranked AS (\n  SELECT\n    _year,\n    _month,\n    interest_id,\n    interest_name,\n    avg_composition,\n    ROW_NUMBER() OVER (\n      PARTITION BY _year, _month\n      ORDER BY avg_composition DESC\n    ) AS rn\n  FROM monthly_interest_avg\n),\nmonthly_max AS (\n  SELECT\n    _year,\n    _month,\n    interest_name,\n    avg_composition AS max_index_composition\n  FROM ranked\n  WHERE rn = 1\n),\nfinal AS (\n  SELECT\n    printf('%04d-%02d-01', _year, _month) AS date,\n    interest_name,\n    max_index_composition,\n    AVG(max_index_composition) OVER (\n      ORDER BY _year, _month\n      ROWS BETWEEN 2 PRECEDING AND CURRENT ROW\n    ) AS rolling_3_month_avg,\n    LAG(interest_name, 1) OVER (ORDER BY _year, _month) AS top_interest_1_month_ago,\n    LAG(max_index_composition, 1) OVER (ORDER BY _year, _month) AS max_index_composition_1_month_ago,\n    LAG(interest_name, 2) OVER (ORDER BY _year, _month) AS top_interest_2_months_ago,\n    LAG(max_index_composition, 2) OVER (ORDER BY _year, _month) AS max_index_composition_2_months_ago\n  FROM monthly_max\n)\nSELECT\n  date,\n  interest_name,\n  max_index_composition,\n  rolling_3_month_avg,\n  top_interest_1_month_ago,\n  max_index_composition_1_month_ago,\n  top_interest_2_months_ago,\n  max_index_composition_2_months_ago\nFROM final\nORDER BY date;\t----- bird -----\tbank_sales_trading_spider2",
    "58": "WITH ranked AS (\n  SELECT\n    im.interest_id,\n    im.month_year,\n    im.composition,\n    ROW_NUMBER() OVER (\n      PARTITION BY im.interest_id\n      ORDER BY im.composition DESC\n    ) AS rn\n  FROM interest_metrics AS im\n),\nper_interest_max AS (\n  SELECT\n    r.interest_id,\n    r.month_year,\n    r.composition\n  FROM ranked AS r\n  WHERE r.rn = 1\n),\ntop10 AS (\n  SELECT\n    pim.interest_id,\n    pim.month_year,\n    pim.composition\n  FROM per_interest_max AS pim\n  ORDER BY pim.composition DESC\n  LIMIT 10\n),\nbottom10 AS (\n  SELECT\n    pim.interest_id,\n    pim.month_year,\n    pim.composition\n  FROM per_interest_max AS pim\n  ORDER BY pim.composition ASC\n  LIMIT 10\n)\nSELECT\n  t.month_year AS time,\n  m.interest_name,\n  t.composition\nFROM top10 AS t\nINNER JOIN interest_map AS m\n  ON m.id = t.interest_id\n\nUNION ALL\n\nSELECT\n  b.month_year AS time,\n  m.interest_name,\n  b.composition\nFROM bottom10 AS b\nINNER JOIN interest_map AS m\n  ON m.id = b.interest_id;\t----- bird -----\tbank_sales_trading_spider2",
    "59": "WITH customers_1998 AS (\n  SELECT DISTINCT o.customerid\n  FROM orders AS o\n  WHERE strftime('%Y', o.orderdate) = '1998'\n),\ncustomer_spend AS (\n  SELECT\n    o.customerid,\n    SUM(od.quantity * od.unitprice) AS total_spent\n  FROM orders AS o\n  INNER JOIN order_details AS od\n    ON od.orderid = o.orderid\n  WHERE strftime('%Y', o.orderdate) = '1998'\n  GROUP BY o.customerid\n),\nassigned_groups AS (\n  SELECT\n    cs.customerid,\n    cgt.groupname\n  FROM customer_spend AS cs\n  INNER JOIN customergroupthreshold AS cgt\n    ON cs.total_spent >= cgt.rangebottom\n   AND cs.total_spent <  cgt.rangetop\n)\nSELECT\n  ag.groupname,\n  COUNT(ag.customerid) AS customer_count,\n  CAST(COUNT(ag.customerid) AS REAL) * 100.0 / (SELECT COUNT(*) FROM customers_1998) AS customer_percentage\nFROM assigned_groups AS ag\nGROUP BY ag.groupname\nORDER BY customer_count DESC;\t----- bird -----\tnorthwind_spider2",
    "60": "SELECT\n  o.employeeid AS employeeid,\n  SUM(CASE WHEN o.shippeddate >= o.requireddate THEN 1 ELSE 0 END) AS late_orders,\n  CAST(SUM(CASE WHEN o.shippeddate >= o.requireddate THEN 1 ELSE 0 END) AS REAL) * 100.0\n    / COUNT(o.orderid) AS late_order_percentage\nFROM orders AS o\nGROUP BY o.employeeid\nHAVING COUNT(o.orderid) > 50\nORDER BY late_orders DESC\nLIMIT 3;\t----- bird -----\tnorthwind_spider2",
    "61": "WITH movie_years AS (\n  SELECT DISTINCT\n    CAST(SUBSTR(Movie.year, -4) AS INTEGER) AS year_num,\n    Movie.MID\n  FROM Movie\n  WHERE Movie.year LIKE '%/%'\n),\nmovies_with_nonfemale_cast AS (\n  SELECT DISTINCT\n    mc.MID\n  FROM M_Cast AS mc\n  INNER JOIN Person AS p\n    ON p.PID = mc.PID\n  WHERE p.Gender IN ('Male', 'None')\n)\nSELECT\n  my.year_num AS year,\n  COUNT(DISTINCT my.MID) AS total_movies,\n  100.0 * SUM(CASE WHEN mn.MID IS NULL THEN 1 ELSE 0 END) / COUNT(DISTINCT my.MID) AS pct_exclusively_female\nFROM movie_years AS my\nLEFT JOIN movies_with_nonfemale_cast AS mn\n  ON mn.MID = my.MID\nGROUP BY\n  my.year_num\nORDER BY\n  my.year_num;\t----- bird -----\tDb-IMDB_spider2",
    "62": "SELECT\n  m1.year AS start_year,\n  COUNT(m2.year) AS total_count\nFROM Movie AS m1\nINNER JOIN Movie AS m2\n  ON m2.year BETWEEN m1.year AND (m1.year + 9)\nGROUP BY\n  m1.year\nORDER BY\n  total_count DESC\nLIMIT 1;\t----- bird -----\tDb-IMDB_spider2",
    "63": "WITH actor_years AS (\n  SELECT\n    mc.PID,\n    m.year\n  FROM M_Cast AS mc\n  INNER JOIN Movie AS m\n    ON mc.MID = m.MID\n  GROUP BY\n    mc.PID,\n    m.year\n),\ngaps AS (\n  SELECT\n    PID,\n    year,\n    year - LAG(year) OVER (PARTITION BY PID ORDER BY year) AS year_gap\n  FROM actor_years\n)\nSELECT\n  COUNT(DISTINCT PID) AS count_actors\nFROM gaps\nGROUP BY PID\nHAVING MAX(COALESCE(year_gap, 1)) <= 4;\t----- bird -----\tDb-IMDB_spider2",
    "64": "SELECT COUNT(DISTINCT mc.PID) AS actor_count\nFROM M_Cast AS mc\nINNER JOIN M_Director AS md\n  ON mc.MID = md.MID\nINNER JOIN Person AS p\n  ON md.PID = p.PID\nWHERE p.Name = 'Yash Chopra';\t----- bird -----\tDb-IMDB_spider2",
    "65": "WITH shahrukh_pid AS (\n  SELECT PID\n  FROM Person\n  WHERE Name = 'Shahrukh Khan'\n),\nshahrukh_movies AS (\n  SELECT mc.MID\n  FROM M_Cast mc\n  INNER JOIN shahrukh_pid sp ON mc.PID = sp.PID\n),\ncoactors_of_shahrukh AS (\n  SELECT DISTINCT mc.PID\n  FROM M_Cast mc\n  INNER JOIN shahrukh_movies sm ON mc.MID = sm.MID\n  WHERE mc.PID <> (SELECT PID FROM shahrukh_pid)\n),\nmovies_with_coactors AS (\n  SELECT DISTINCT mc.MID\n  FROM M_Cast mc\n  INNER JOIN coactors_of_shahrukh c ON mc.PID = c.PID\n),\nshahrukh_number_2 AS (\n  SELECT DISTINCT mc.PID\n  FROM M_Cast mc\n  INNER JOIN movies_with_coactors mwc ON mc.MID = mwc.MID\n  WHERE mc.PID <> (SELECT PID FROM shahrukh_pid)\n    AND mc.PID NOT IN (SELECT PID FROM coactors_of_shahrukh)\n)\nSELECT COUNT(*) AS actor_count\nFROM shahrukh_number_2;\t----- bird -----\tDb-IMDB_spider2",
    "66": "WITH region_summary AS (\n  SELECT\n    r.name AS region_name,\n    SUM(o.total_amt_usd) AS total_sales,\n    COUNT(o.id) AS num_orders\n  FROM web_region AS r\n  INNER JOIN web_sales_reps AS s\n    ON s.region_id = r.id\n  INNER JOIN web_accounts AS a\n    ON a.sales_rep_id = s.id\n  INNER JOIN web_orders AS o\n    ON o.account_id = a.id\n  GROUP BY r.name\n),\nrep_sales AS (\n  SELECT\n    r.id AS region_id,\n    r.name AS region_name,\n    s.name AS sales_rep_name,\n    SUM(o.total_amt_usd) AS rep_total_sales\n  FROM web_region AS r\n  INNER JOIN web_sales_reps AS s\n    ON s.region_id = r.id\n  INNER JOIN web_accounts AS a\n    ON a.sales_rep_id = s.id\n  INNER JOIN web_orders AS o\n    ON o.account_id = a.id\n  GROUP BY r.id, r.name, s.name\n),\nregion_max AS (\n  SELECT\n    region_id,\n    MAX(rep_total_sales) AS max_rep_total_sales\n  FROM rep_sales\n  GROUP BY region_id\n)\nSELECT\n  rs.region_name,\n  rs.total_sales,\n  rs.num_orders,\n  rps.sales_rep_name,\n  rps.rep_total_sales\nFROM region_summary AS rs\nINNER JOIN rep_sales AS rps\n  ON rps.region_name = rs.region_name\nINNER JOIN region_max AS rm\n  ON rm.region_id = rps.region_id\n AND rm.max_rep_total_sales = rps.rep_total_sales\nORDER BY\n  rs.region_name,\n  rps.sales_rep_name;\t----- bird -----\teducation_business_spider2",
    "67": "SELECT\n  b.BowlerID,\n  b.BowlerFirstName,\n  b.BowlerLastName,\n  bs.MatchID,\n  bs.GameNumber,\n  bs.HandiCapScore,\n  t.TourneyDate,\n  t.TourneyLocation\nFROM Bowler_Scores AS bs\nINNER JOIN Bowlers AS b\n  ON bs.BowlerID = b.BowlerID\nINNER JOIN Tourney_Matches AS tm\n  ON bs.MatchID = tm.MatchID\nINNER JOIN Tournaments AS t\n  ON tm.TourneyID = t.TourneyID\nWHERE\n  bs.WonGame = 1\n  AND bs.HandiCapScore <= 190\n  AND t.TourneyLocation IN ('Thunderbird Lanes', 'Totem Lanes', 'Bolero Lanes')\n  AND bs.BowlerID IN (\n    SELECT bs2.BowlerID\n    FROM Bowler_Scores AS bs2\n    INNER JOIN Tourney_Matches AS tm2\n      ON bs2.MatchID = tm2.MatchID\n    INNER JOIN Tournaments AS t2\n      ON tm2.TourneyID = t2.TourneyID\n    WHERE\n      bs2.WonGame = 1\n      AND bs2.HandiCapScore <= 190\n      AND t2.TourneyLocation IN ('Thunderbird Lanes', 'Totem Lanes', 'Bolero Lanes')\n    GROUP BY bs2.BowlerID\n    HAVING COUNT(DISTINCT t2.TourneyLocation) = 3\n  )\nORDER BY\n  b.BowlerID,\n  t.TourneyLocation,\n  bs.MatchID,\n  bs.GameNumber;\t----- bird -----\tBowlingLeague_spider2",
    "68": "WITH english_completed AS (\n  SELECT\n    st.StudentID,\n    st.StudLastName,\n    ss.Grade\n  FROM Student_Schedules AS ss\n  INNER JOIN Students AS st\n    ON ss.StudentID = st.StudentID\n  INNER JOIN Classes AS c\n    ON ss.ClassID = c.ClassID\n  INNER JOIN Subjects AS sub\n    ON c.SubjectID = sub.SubjectID\n  WHERE sub.SubjectName = 'English'\n    AND ss.ClassStatus = 2\n),\nranked AS (\n  SELECT\n    ec.StudLastName,\n    ec.Grade,\n    (\n      SELECT COUNT(*)\n      FROM english_completed AS ec2\n      WHERE ec2.Grade >= ec.Grade\n    ) AS ge_rank,\n    (SELECT COUNT(*) FROM english_completed) AS total_cnt\n  FROM english_completed AS ec\n)\nSELECT\n  StudLastName,\n  CASE\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.2 THEN 'First'\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.4 THEN 'Second'\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.6 THEN 'Third'\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.8 THEN 'Fourth'\n    ELSE 'Fifth'\n  END AS Quintile\nFROM ranked\nORDER BY\n  CASE\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.2 THEN 1\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.4 THEN 2\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.6 THEN 3\n    WHEN (1.0 * ge_rank / total_cnt) <= 0.8 THEN 4\n    ELSE 5\n  END,\n  Grade DESC,\n  StudLastName;\t----- bird -----\tschool_scheduling_spider2",
    "69": "SELECT\n  ms.StyleName,\n  SUM(CASE WHEN mp.PreferenceSeq = 1 THEN 1 ELSE 0 END) AS PrefSeq1_Count,\n  SUM(CASE WHEN mp.PreferenceSeq = 2 THEN 1 ELSE 0 END) AS PrefSeq2_Count,\n  SUM(CASE WHEN mp.PreferenceSeq = 3 THEN 1 ELSE 0 END) AS PrefSeq3_Count\nFROM Musical_Styles AS ms\nINNER JOIN Musical_Preferences AS mp\n  ON mp.StyleID = ms.StyleID\nGROUP BY\n  ms.StyleID,\n  ms.StyleName;\t----- bird -----\tEntertainmentAgency_spider2",
    "70": "WITH style_scores AS (\n  SELECT\n    ms.StyleID,\n    SUM(\n      CASE mp.PreferenceSeq\n        WHEN 1 THEN 3\n        WHEN 2 THEN 2\n        WHEN 3 THEN 1\n        ELSE 0\n      END\n    ) AS total_weighted_score\n  FROM Musical_Preferences AS mp\n  INNER JOIN Musical_Styles AS ms\n    ON mp.StyleID = ms.StyleID\n  WHERE mp.PreferenceSeq IN (1, 2, 3)\n  GROUP BY ms.StyleID\n),\navg_score AS (\n  SELECT AVG(total_weighted_score) AS avg_total_weighted_score\n  FROM style_scores\n)\nSELECT\n  ss.StyleID,\n  ABS(ss.total_weighted_score - a.avg_total_weighted_score) AS abs_diff_from_avg\nFROM style_scores AS ss\nCROSS JOIN avg_score AS a;\t----- bird -----\tEntertainmentAgency_spider2",
    "71": "SELECT\n  e.EntStageName,\n  c.CustLastName\nFROM Entertainers AS e\nINNER JOIN Entertainer_Styles AS es1\n  ON es1.EntertainerID = e.EntertainerID\nINNER JOIN Entertainer_Styles AS es2\n  ON es2.EntertainerID = e.EntertainerID\nINNER JOIN Musical_Preferences AS mp1\n  ON mp1.CustomerID = c.CustomerID\nINNER JOIN Musical_Preferences AS mp2\n  ON mp2.CustomerID = c.CustomerID\nINNER JOIN Customers AS c\n  ON c.CustomerID = mp1.CustomerID\nWHERE\n  es1.StyleStrength IN ('High', 'Medium')\n  AND es2.StyleStrength IN ('High', 'Medium')\n  AND mp1.PreferenceSeq IN (1, 2)\n  AND mp2.PreferenceSeq IN (1, 2)\n  AND es1.StyleID <> es2.StyleID\n  AND mp1.StyleID <> mp2.StyleID\n  AND (\n    (es1.StyleID = mp1.StyleID AND es2.StyleID = mp2.StyleID)\n    OR\n    (es1.StyleID = mp2.StyleID AND es2.StyleID = mp1.StyleID)\n  )\nGROUP BY\n  e.EntStageName,\n  c.CustLastName;\t----- bird -----\tEntertainmentAgency_spider2",
    "72": "SELECT\n  sp.businessentityid AS salesperson_id,\n  strftime('%Y', soh.orderdate) AS sales_year,\n  SUM(soh.subtotal) - SUM(sp.salesquota) AS sales_minus_quota\nFROM salesorderheader AS soh\nINNER JOIN salesperson AS sp\n  ON soh.salespersonid = sp.businessentityid\nGROUP BY\n  sp.businessentityid,\n  strftime('%Y', soh.orderdate)\nORDER BY\n  sp.businessentityid,\n  sales_year;\t----- bird -----\tAdventureWorks_spider2",
    "73": "SELECT\n  dm.name_id AS director_id,\n  n.name AS director_name,\n  COUNT(dm.movie_id) AS movie_count,\n  ROUND(AVG(m.duration), 0) AS avg_movie_duration,\n  ROUND(AVG(r.avg_rating), 2) AS avg_rating,\n  SUM(r.total_votes) AS total_votes,\n  MIN(r.avg_rating) AS min_rating,\n  MAX(r.avg_rating) AS max_rating,\n  SUM(m.duration) AS total_movie_duration\nFROM director_mapping AS dm\nINNER JOIN names AS n\n  ON n.id = dm.name_id\nINNER JOIN movies AS m\n  ON m.id = dm.movie_id\nINNER JOIN ratings AS r\n  ON r.movie_id = m.id\nGROUP BY\n  dm.name_id,\n  n.name\nORDER BY\n  movie_count DESC,\n  total_movie_duration DESC\nLIMIT 9;\t----- bird -----\timdb_movies_spider2",
    "74": "WITH top_genres AS (\n  SELECT\n    g.genre\n  FROM ratings r\n  INNER JOIN genre g\n    ON g.movie_id = r.movie_id\n  WHERE r.avg_rating > 8\n  GROUP BY g.genre\n  ORDER BY COUNT(DISTINCT g.movie_id) DESC\n  LIMIT 3\n),\ntop_directors AS (\n  SELECT\n    dm.name_id,\n    COUNT(dm.movie_id) AS movie_count\n  FROM ratings r\n  INNER JOIN genre g\n    ON g.movie_id = r.movie_id\n  INNER JOIN director_mapping dm\n    ON dm.movie_id = r.movie_id\n  INNER JOIN top_genres tg\n    ON tg.genre = g.genre\n  WHERE r.avg_rating > 8\n  GROUP BY dm.name_id\n  ORDER BY movie_count DESC\n  LIMIT 4\n)\nSELECT\n  n.name AS director,\n  td.movie_count\nFROM top_directors td\nINNER JOIN names n\n  ON n.id = td.name_id\nORDER BY td.movie_count DESC;\t----- bird -----\timdb_movies_spider2",
    "75": "WITH yearly_region AS (\n  SELECT\n    bm.region AS region,\n    CAST(strftime('%Y', bp.market_date) AS INTEGER) AS year,\n    SUM(bt.quantity * bp.price) AS total_dollar_amount,\n    SUM(bt.quantity) AS total_quantity\n  FROM bitcoin_transactions AS bt\n  INNER JOIN bitcoin_members AS bm\n    ON bt.member_id = bm.member_id\n  INNER JOIN bitcoin_prices AS bp\n    ON bt.ticker = bp.ticker\n   AND bt.txn_date = bp.market_date\n  WHERE bt.txn_type = 'purchase'\n  GROUP BY\n    bm.region,\n    CAST(strftime('%Y', bp.market_date) AS INTEGER)\n),\nwith_avg AS (\n  SELECT\n    region,\n    year,\n    (total_dollar_amount * 1.0) / NULLIF(total_quantity, 0) AS avg_purchase_price\n  FROM yearly_region\n),\nexclude_first_year AS (\n  SELECT\n    region,\n    year,\n    avg_purchase_price,\n    LAG(avg_purchase_price) OVER (PARTITION BY region ORDER BY year) AS prev_year_avg\n  FROM with_avg\n),\nfinal AS (\n  SELECT\n    region,\n    year,\n    avg_purchase_price,\n    RANK() OVER (PARTITION BY year ORDER BY avg_purchase_price DESC) AS region_rank_in_year,\n    (avg_purchase_price - prev_year_avg) * 100.0 / NULLIF(prev_year_avg, 0) AS pct_change_vs_prev_year\n  FROM exclude_first_year\n  WHERE prev_year_avg IS NOT NULL\n)\nSELECT\n  region,\n  year,\n  avg_purchase_price,\n  region_rank_in_year,\n  pct_change_vs_prev_year\nFROM final\nORDER BY\n  year,\n  region_rank_in_year,\n  region;\t----- bird -----\tbank_sales_trading_spider2",
    "76": "WITH base AS (\n  SELECT\n    ticker,\n    market_date,\n    volume,\n    CASE\n      WHEN volume IS NULL OR TRIM(volume) = '-' THEN 0.0\n      WHEN UPPER(TRIM(volume)) LIKE '%K' THEN CAST(REPLACE(UPPER(TRIM(volume)), 'K', '') AS REAL) * 1000.0\n      WHEN UPPER(TRIM(volume)) LIKE '%M' THEN CAST(REPLACE(UPPER(TRIM(volume)), 'M', '') AS REAL) * 1000000.0\n      ELSE CAST(TRIM(volume) AS REAL)\n    END AS volume_num\n  FROM bitcoin_prices\n  WHERE market_date >= '2021-08-01'\n    AND market_date <= '2021-08-10'\n),\nnonzero AS (\n  -- only non-zero volumes are used to determine the previous day's volume\n  SELECT\n    ticker,\n    market_date,\n    volume_num,\n    LAG(volume_num) OVER (PARTITION BY ticker ORDER BY market_date) AS prev_volume_num\n  FROM base\n  WHERE volume_num <> 0.0\n)\nSELECT\n  ticker,\n  market_date,\n  volume_num AS volume_converted,\n  prev_volume_num AS prev_nonzero_volume,\n  ROUND(((volume_num - prev_volume_num) * 100.0) / prev_volume_num, 6) AS daily_pct_change_volume\nFROM nonzero\nWHERE prev_volume_num IS NOT NULL\nORDER BY ticker, market_date;\t----- bird -----\tbank_sales_trading_spider2",
    "77": "WITH rank_avg AS (\n  SELECT\n    FacRank,\n    AVG(FacSalary) AS avg_salary\n  FROM university_faculty\n  GROUP BY FacRank\n),\nrank_diff AS (\n  SELECT\n    uf.FacRank,\n    uf.FacFirstName,\n    uf.FacLastName,\n    uf.FacSalary,\n    ABS(uf.FacSalary - ra.avg_salary) AS diff_to_avg\n  FROM university_faculty AS uf\n  INNER JOIN rank_avg AS ra\n    ON uf.FacRank = ra.FacRank\n),\nmin_diff AS (\n  SELECT\n    FacRank,\n    MIN(diff_to_avg) AS min_diff_to_avg\n  FROM rank_diff\n  GROUP BY FacRank\n)\nSELECT\n  rd.FacRank,\n  rd.FacFirstName,\n  rd.FacLastName,\n  rd.FacSalary\nFROM rank_diff AS rd\nINNER JOIN min_diff AS md\n  ON rd.FacRank = md.FacRank\n AND rd.diff_to_avg = md.min_diff_to_avg\nORDER BY\n  rd.FacRank,\n  rd.FacLastName,\n  rd.FacFirstName;\t----- bird -----\teducation_business_spider2",
    "78": "WITH filtered_jobs AS (\n  SELECT\n    j.job_id,\n    j.salary_year_avg\n  FROM job_postings_fact AS j\n  WHERE j.job_title = 'Data Analyst'\n    AND j.job_work_from_home = 1\n    AND j.salary_year_avg IS NOT NULL\n),\ntop_skills AS (\n  SELECT\n    s.skill_id\n  FROM skills_job_dim AS s\n  INNER JOIN filtered_jobs AS fj\n    ON fj.job_id = s.job_id\n  GROUP BY s.skill_id\n  ORDER BY COUNT(*) DESC\n  LIMIT 3\n)\nSELECT\n  AVG(fj.salary_year_avg) AS overall_avg_salary\nFROM filtered_jobs AS fj\nINNER JOIN skills_job_dim AS s\n  ON s.job_id = fj.job_id\nINNER JOIN top_skills AS ts\n  ON ts.skill_id = s.skill_id;\t----- bird -----\tcity_legislation_spider2",
    "79": "WITH\n-- Cohort: legislators whose FIRST term_start is within the window\ncohort AS (\n  SELECT\n    lt.id_bioguide,\n    MIN(lt.term_start) AS first_term_start\n  FROM legislators_terms AS lt\n  GROUP BY lt.id_bioguide\n  HAVING MIN(lt.term_start) BETWEEN '1917-01-01' AND '1999-12-31'\n),\ncohort_size AS (\n  SELECT COUNT(*) AS n_cohort\n  FROM cohort\n),\n-- Generate the first 20 year-ends after initial start: year 1..20\nperiods AS (\n  SELECT 1 AS year_number\n  UNION ALL\n  SELECT year_number + 1\n  FROM periods\n  WHERE year_number < 20\n),\n-- For each cohort member and each period, compute the \"as-of\" date:\n-- Dec 31 of (start_year + year_number - 1)\nasof_dates AS (\n  SELECT\n    c.id_bioguide,\n    p.year_number,\n    date(\n      printf('%04d-12-31', CAST(strftime('%Y', c.first_term_start) AS INTEGER) + p.year_number - 1)\n    ) AS asof_date\n  FROM cohort AS c\n  CROSS JOIN periods AS p\n),\n-- Retained if they have ANY term covering that as-of date\nretained AS (\n  SELECT\n    a.year_number,\n    COUNT(DISTINCT a.id_bioguide) AS retained_count\n  FROM asof_dates AS a\n  INNER JOIN legislators_terms AS lt\n    ON lt.id_bioguide = a.id_bioguide\n   AND lt.term_start <= a.asof_date\n   AND (lt.term_end IS NULL OR lt.term_end >= a.asof_date)\n  GROUP BY a.year_number\n)\nSELECT\n  p.year_number,\n  COALESCE(r.retained_count, 0) * 1.0 / cs.n_cohort AS retention_rate\nFROM periods AS p\nCROSS JOIN cohort_size AS cs\nLEFT JOIN retained AS r\n  ON r.year_number = p.year_number\nORDER BY p.year_number;\t----- bird -----\tcity_legislation_spider2",
    "80": "SELECT\n  (CAST(strftime('%Y', lt.term_end) AS INTEGER) - CAST(strftime('%Y', lt.term_start) AS INTEGER)) AS years_elapsed,\n  COUNT(DISTINCT l.id_bioguide) AS distinct_legislators\nFROM legislators AS l\nINNER JOIN legislators_terms AS lt\n  ON l.id_bioguide = lt.id_bioguide\nWHERE l.gender = 'M'\n  AND lt.state = 'Louisiana'\n  AND lt.term_start >= '1970-01-01'\n  AND lt.term_end < '1980-01-01'\n  AND (CAST(strftime('%Y', lt.term_end) AS INTEGER) - CAST(strftime('%Y', lt.term_start) AS INTEGER)) > 30\n  AND (CAST(strftime('%Y', lt.term_end) AS INTEGER) - CAST(strftime('%Y', lt.term_start) AS INTEGER)) < 50\nGROUP BY\n  years_elapsed\nORDER BY\n  years_elapsed;\t----- bird -----\tcity_legislation_spider2",
    "81": "SELECT lt.state\nFROM legislators AS l\nINNER JOIN legislators_terms AS lt\n  ON l.id_bioguide = lt.id_bioguide\nWHERE l.gender = 'F'\n  AND strftime('%m-%d', lt.term_end) = '12-31'\nGROUP BY lt.state\nORDER BY COUNT(*) DESC\nLIMIT 1;\t----- bird -----\tcity_legislation_spider2",
    "82": "WITH first_term AS (\n  SELECT\n    lt.id_bioguide,\n    lt.state,\n    MIN(lt.term_start) AS first_start\n  FROM legislators_terms AS lt\n  GROUP BY lt.id_bioguide, lt.state\n),\nretained_flags AS (\n  SELECT\n    ft.state,\n    l.gender,\n    ft.id_bioguide,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(strftime('%Y', ft.first_start) || '-12-31')\n          AND lt.term_end   >= date(strftime('%Y', ft.first_start) || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r0,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 2 || '-12-31')\n          AND lt.term_end   >= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 2 || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r2,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 4 || '-12-31')\n          AND lt.term_end   >= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 4 || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r4,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 6 || '-12-31')\n          AND lt.term_end   >= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 6 || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r6,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 8 || '-12-31')\n          AND lt.term_end   >= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 8 || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r8,\n    CASE\n      WHEN EXISTS (\n        SELECT 1\n        FROM legislators_terms AS lt\n        WHERE lt.id_bioguide = ft.id_bioguide\n          AND lt.state = ft.state\n          AND lt.term_start <= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 10 || '-12-31')\n          AND lt.term_end   >= date(CAST(strftime('%Y', ft.first_start) AS INTEGER) + 10 || '-12-31')\n      ) THEN 1 ELSE 0\n    END AS r10\n  FROM first_term AS ft\n  INNER JOIN legislators AS l\n    ON l.id_bioguide = ft.id_bioguide\n),\nstate_gender_retention AS (\n  SELECT\n    state,\n    gender,\n    SUM(r0)  AS c0,\n    SUM(r2)  AS c2,\n    SUM(r4)  AS c4,\n    SUM(r6)  AS c6,\n    SUM(r8)  AS c8,\n    SUM(r10) AS c10\n  FROM retained_flags\n  GROUP BY state, gender\n),\nstates_ok AS (\n  SELECT\n    state\n  FROM state_gender_retention\n  WHERE gender IN ('M','F')\n    AND c0  > 0 AND c2  > 0 AND c4  > 0\n    AND c6  > 0 AND c8  > 0 AND c10 > 0\n  GROUP BY state\n  HAVING COUNT(DISTINCT gender) = 2\n)\nSELECT state\nFROM states_ok\nORDER BY state;\t----- bird -----\tcity_legislation_spider2",
    "83": "WITH customer_first_purchase AS (\n  SELECT\n    p.customer_id,\n    MIN(p.payment_date) AS first_payment_date\n  FROM payment AS p\n  WHERE p.payment_date IS NOT NULL\n  GROUP BY p.customer_id\n),\ncustomer_ltv AS (\n  SELECT\n    p.customer_id,\n    SUM(p.amount) AS ltv\n  FROM payment AS p\n  WHERE p.payment_date IS NOT NULL\n  GROUP BY p.customer_id\n),\ncustomer_window_sums AS (\n  SELECT\n    p.customer_id,\n    SUM(\n      CASE\n        WHEN (julianday(p.payment_date) - julianday(fp.first_payment_date)) * 86400.0 >= 0\n         AND (julianday(p.payment_date) - julianday(fp.first_payment_date)) * 86400.0 < 7 * 86400.0\n        THEN p.amount ELSE 0\n      END\n    ) AS amt_7d,\n    SUM(\n      CASE\n        WHEN (julianday(p.payment_date) - julianday(fp.first_payment_date)) * 86400.0 >= 0\n         AND (julianday(p.payment_date) - julianday(fp.first_payment_date)) * 86400.0 < 30 * 86400.0\n        THEN p.amount ELSE 0\n      END\n    ) AS amt_30d\n  FROM payment AS p\n  INNER JOIN customer_first_purchase AS fp\n    ON p.customer_id = fp.customer_id\n  WHERE p.payment_date IS NOT NULL\n  GROUP BY p.customer_id\n)\nSELECT\n  AVG(CASE WHEN l.ltv > 0 THEN (w.amt_7d * 1.0) / l.ltv END) AS avg_pct_ltv_first_7_days,\n  AVG(CASE WHEN l.ltv > 0 THEN (w.amt_30d * 1.0) / l.ltv END) AS avg_pct_ltv_first_30_days,\n  AVG(l.ltv) AS avg_total_ltv\nFROM customer_ltv AS l\nINNER JOIN customer_window_sums AS w\n  ON l.customer_id = w.customer_id\nWHERE l.ltv > 0;\t----- bird -----\tsqlite-sakila_spider2",
    "84": "WITH film_revenue AS (\n  SELECT\n    f.film_id,\n    f.title,\n    SUM(p.amount) AS total_revenue\n  FROM film AS f\n  INNER JOIN inventory AS i\n    ON i.film_id = f.film_id\n  INNER JOIN rental AS r\n    ON r.inventory_id = i.inventory_id\n  INNER JOIN payment AS p\n    ON p.rental_id = r.rental_id\n  GROUP BY\n    f.film_id,\n    f.title\n),\nfilm_actor_count AS (\n  SELECT\n    fa.film_id,\n    COUNT(DISTINCT fa.actor_id) AS actor_cnt\n  FROM film_actor AS fa\n  GROUP BY\n    fa.film_id\n),\nactor_film_revenue AS (\n  SELECT\n    fa.actor_id,\n    fr.film_id,\n    fr.title,\n    fr.total_revenue,\n    (fr.total_revenue * 1.0) / fac.actor_cnt AS actor_share_revenue\n  FROM film_actor AS fa\n  INNER JOIN film_revenue AS fr\n    ON fr.film_id = fa.film_id\n  INNER JOIN film_actor_count AS fac\n    ON fac.film_id = fa.film_id\n),\nranked AS (\n  SELECT\n    a.actor_id,\n    a.first_name,\n    a.last_name,\n    afr.film_id,\n    afr.title,\n    afr.total_revenue,\n    afr.actor_share_revenue,\n    ROW_NUMBER() OVER (\n      PARTITION BY a.actor_id\n      ORDER BY afr.total_revenue DESC\n    ) AS rn\n  FROM actor AS a\n  INNER JOIN actor_film_revenue AS afr\n    ON afr.actor_id = a.actor_id\n),\ntop3 AS (\n  SELECT *\n  FROM ranked\n  WHERE rn <= 3\n),\navg_share_in_top3 AS (\n  SELECT\n    actor_id,\n    AVG(actor_share_revenue) AS avg_revenue_per_actor_in_top3\n  FROM top3\n  GROUP BY actor_id\n)\nSELECT\n  t.actor_id,\n  t.first_name,\n  t.last_name,\n  t.film_id,\n  t.title,\n  t.total_revenue,\n  a3.avg_revenue_per_actor_in_top3\nFROM top3 AS t\nINNER JOIN avg_share_in_top3 AS a3\n  ON a3.actor_id = t.actor_id\nORDER BY\n  t.actor_id,\n  t.total_revenue DESC;\t----- bird -----\tsqlite-sakila_spider2",
    "85": "WITH top_actors AS (\n  SELECT\n    fa.actor_id\n  FROM film_actor AS fa\n  GROUP BY fa.actor_id\n  ORDER BY COUNT(*) DESC\n  LIMIT 5\n),\ncustomers_who_rented_top_actors AS (\n  SELECT DISTINCT\n    r.customer_id\n  FROM rental AS r\n  INNER JOIN inventory AS i\n    ON r.inventory_id = i.inventory_id\n  INNER JOIN film_actor AS fa\n    ON i.film_id = fa.film_id\n  INNER JOIN top_actors AS ta\n    ON fa.actor_id = ta.actor_id\n)\nSELECT\n  CAST((SELECT COUNT(*) FROM customers_who_rented_top_actors) AS REAL) * 100.0\n  / (SELECT COUNT(*) FROM customer) AS percentage_of_customers\n;\t----- bird -----\tsqlite-sakila_spider2",
    "86": "WITH first_payment_per_customer AS (\n  SELECT\n    p.customer_id,\n    MIN(p.payment_date) AS first_payment_date\n  FROM payment AS p\n  GROUP BY p.customer_id\n),\nfirst_rental_per_customer AS (\n  SELECT\n    p.customer_id,\n    p.rental_id\n  FROM payment AS p\n  INNER JOIN first_payment_per_customer AS f\n    ON f.customer_id = p.customer_id\n   AND f.first_payment_date = p.payment_date\n),\ncustomer_first_rating AS (\n  SELECT\n    fr.customer_id,\n    fi.rating\n  FROM first_rental_per_customer AS fr\n  INNER JOIN rental AS r\n    ON r.rental_id = fr.rental_id\n  INNER JOIN inventory AS i\n    ON i.inventory_id = r.inventory_id\n  INNER JOIN film AS fi\n    ON fi.film_id = i.film_id\n),\ncustomer_total_spent AS (\n  SELECT\n    p.customer_id,\n    SUM(p.amount) AS total_spent\n  FROM payment AS p\n  GROUP BY p.customer_id\n),\ncustomer_total_rentals AS (\n  SELECT\n    r.customer_id,\n    COUNT(r.rental_id) AS total_rentals\n  FROM rental AS r\n  GROUP BY r.customer_id\n)\nSELECT\n  cfr.rating,\n  AVG(cts.total_spent) AS avg_total_amount_spent_per_customer,\n  AVG(ctr.total_rentals - 1) AS avg_subsequent_rentals\nFROM customer_first_rating AS cfr\nINNER JOIN customer_total_spent AS cts\n  ON cts.customer_id = cfr.customer_id\nINNER JOIN customer_total_rentals AS ctr\n  ON ctr.customer_id = cfr.customer_id\nGROUP BY cfr.rating;\t----- bird -----\tsqlite-sakila_spider2",
    "87": "WITH top_customers AS (\n  SELECT\n    p.customer_id\n  FROM payment AS p\n  GROUP BY\n    p.customer_id\n  ORDER BY\n    SUM(p.amount) DESC\n  LIMIT 10\n),\nmonthly_totals AS (\n  SELECT\n    p.customer_id,\n    strftime('%Y-%m', p.payment_date) AS pay_month,\n    SUM(p.amount) AS month_total\n  FROM payment AS p\n  INNER JOIN top_customers AS tc\n    ON tc.customer_id = p.customer_id\n  GROUP BY\n    p.customer_id,\n    strftime('%Y-%m', p.payment_date)\n),\nmom_changes AS (\n  SELECT\n    mt.customer_id,\n    mt.pay_month,\n    mt.month_total - LAG(mt.month_total) OVER (\n      PARTITION BY mt.customer_id\n      ORDER BY mt.pay_month\n    ) AS mom_diff\n  FROM monthly_totals AS mt\n)\nSELECT\n  mc.customer_id,\n  mc.pay_month AS month,\n  ROUND(mc.mom_diff, 2) AS max_month_over_month_difference\nFROM mom_changes AS mc\nWHERE mc.mom_diff IS NOT NULL\nORDER BY mc.mom_diff DESC\nLIMIT 1;\t----- bird -----\tsqlite-sakila_spider2",
    "88": "WITH monthly_rentals AS (\n  SELECT\n    s.store_id,\n    CAST(strftime('%Y', r.rental_date) AS INTEGER) AS year,\n    CAST(strftime('%m', r.rental_date) AS INTEGER) AS month,\n    COUNT(r.rental_id) AS total_rentals\n  FROM rental AS r\n  INNER JOIN staff AS s\n    ON r.staff_id = s.staff_id\n  GROUP BY\n    s.store_id,\n    CAST(strftime('%Y', r.rental_date) AS INTEGER),\n    CAST(strftime('%m', r.rental_date) AS INTEGER)\n),\nranked AS (\n  SELECT\n    store_id,\n    year,\n    month,\n    total_rentals,\n    ROW_NUMBER() OVER (\n      PARTITION BY store_id\n      ORDER BY total_rentals DESC\n    ) AS rn\n  FROM monthly_rentals\n)\nSELECT\n  store_id,\n  year,\n  month,\n  total_rentals\nFROM ranked\nWHERE rn = 1\nORDER BY store_id;\t----- bird -----\tsqlite-sakila_spider2",
    "89": "SELECT\n  w1.words,\n  COUNT(w2.words) AS anagram_count\nFROM word_list AS w1\nINNER JOIN word_list AS w2\n  ON LENGTH(w1.words) = LENGTH(w2.words)\n AND w1.words <> w2.words\n AND (\n   SELECT GROUP_CONCAT(SUBSTR(w1.words, n, 1), '')\n   FROM (\n     SELECT 1 AS n UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5\n   )\n   WHERE n <= LENGTH(w1.words)\n   ORDER BY SUBSTR(w1.words, n, 1)\n ) = (\n   SELECT GROUP_CONCAT(SUBSTR(w2.words, n, 1), '')\n   FROM (\n     SELECT 1 AS n UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5\n   )\n   WHERE n <= LENGTH(w2.words)\n   ORDER BY SUBSTR(w2.words, n, 1)\n )\nWHERE w1.words LIKE 'r%'\n  AND LENGTH(w1.words) BETWEEN 4 AND 5\nGROUP BY w1.words\nHAVING COUNT(w2.words) >= 1\nORDER BY w1.words\nLIMIT 10;\t----- bird -----\tmodern_data_spider2",
    "90": "WITH state_stats AS (\n  SELECT\n    state,\n    COUNT(*) AS total_aliens,\n    AVG(age) AS avg_age,\n    SUM(CASE WHEN type = 'friendly' THEN 1 ELSE 0 END) AS friendly_cnt,\n    SUM(CASE WHEN type = 'hostile' THEN 1 ELSE 0 END) AS hostile_cnt\n  FROM alien_data\n  WHERE age > 200\n  GROUP BY state\n),\ntop10_states AS (\n  SELECT *\n  FROM state_stats\n  ORDER BY total_aliens DESC\n  LIMIT 10\n)\nSELECT\n  COUNT(*) AS count_states\nFROM top10_states\nWHERE (1.0 * friendly_cnt / NULLIF(total_aliens, 0)) > (1.0 * hostile_cnt / NULLIF(total_aliens, 0));\t----- bird -----\tcity_legislation_spider2",
    "91": "WITH store_order_counts AS (\n  SELECT\n    o.store_id,\n    COUNT(o.order_id) AS total_orders\n  FROM orders AS o\n  INNER JOIN stores AS s\n    ON o.store_id = s.store_id\n  GROUP BY o.store_id\n),\ntop_store AS (\n  SELECT\n    store_id,\n    total_orders\n  FROM store_order_counts\n  ORDER BY total_orders DESC\n  LIMIT 1\n),\ntop_store_delivered AS (\n  SELECT\n    o.store_id,\n    COUNT(*) AS delivered_orders\n  FROM orders AS o\n  INNER JOIN deliveries AS d\n    ON o.delivery_order_id = d.delivery_order_id\n  WHERE d.delivery_status = 'DELIVERED'\n  GROUP BY o.store_id\n)\nSELECT\n  s.store_name,\n  CAST(COALESCE(tsd.delivered_orders, 0) AS REAL) / ts.total_orders AS delivered_ratio\nFROM top_store AS ts\nINNER JOIN stores AS s\n  ON ts.store_id = s.store_id\nLEFT JOIN top_store_delivered AS tsd\n  ON ts.store_id = tsd.store_id;\t----- bird -----\tdelivery_center_spider2",
    "92": "WITH finished_orders AS (\n  SELECT\n    o.order_id,\n    o.store_id,\n    o.order_created_month\n  FROM orders AS o\n  WHERE o.order_status = 'Finished'\n    AND o.order_created_month IN (2, 3)\n),\nhub_month_counts AS (\n  SELECT\n    h.hub_id,\n    h.hub_name,\n    fo.order_created_month,\n    COUNT(fo.order_id) AS finished_cnt\n  FROM finished_orders AS fo\n  INNER JOIN stores AS s\n    ON fo.store_id = s.store_id\n  INNER JOIN hubs AS h\n    ON s.hub_id = h.hub_id\n  GROUP BY\n    h.hub_id, h.hub_name, fo.order_created_month\n),\nhub_feb_mar AS (\n  SELECT\n    hub_id,\n    hub_name,\n    SUM(CASE WHEN order_created_month = 2 THEN finished_cnt ELSE 0 END) AS feb_finished,\n    SUM(CASE WHEN order_created_month = 3 THEN finished_cnt ELSE 0 END) AS mar_finished\n  FROM hub_month_counts\n  GROUP BY hub_id, hub_name\n)\nSELECT\n  hub_name\nFROM hub_feb_mar\nWHERE feb_finished > 0\n  AND (mar_finished - feb_finished) * 1.0 / feb_finished > 0.2;\t----- bird -----\tdelivery_center_spider2",
    "93": "SELECT\n  d.driver_id\nFROM deliveries AS d\nWHERE d.delivery_status = 'DELIVERED'\nGROUP BY d.driver_id\nORDER BY COUNT(d.delivery_order_id) DESC\nLIMIT 5;\t----- bird -----\tdelivery_center_spider2",
    "94": "WITH team_goals AS (\n  SELECT\n    t.team_api_id,\n    SUM(\n      CASE\n        WHEN m.home_team_api_id = t.team_api_id THEN m.home_team_goal\n        WHEN m.away_team_api_id = t.team_api_id THEN m.away_team_goal\n        ELSE 0\n      END\n    ) AS total_goals\n  FROM Team AS t\n  INNER JOIN Match AS m\n    ON m.home_team_api_id = t.team_api_id\n    OR m.away_team_api_id = t.team_api_id\n  GROUP BY t.team_api_id\n),\ntop_team AS (\n  SELECT total_goals\n  FROM team_goals\n  ORDER BY total_goals DESC\n  LIMIT 1\n)\nSELECT CAST(total_goals AS REAL) / 2.0 AS median\nFROM top_team;\t----- bird -----\tEU_soccer_spider2",
    "95": "WITH team_wins AS (\n  SELECT\n    l.name AS league_name,\n    t.team_api_id,\n    t.team_long_name,\n    SUM(\n      CASE\n        WHEN m.home_team_goal > m.away_team_goal THEN 1\n        ELSE 0\n      END\n    ) AS total_wins\n  FROM League AS l\n  INNER JOIN Match AS m\n    ON m.league_id = l.id\n  INNER JOIN Team AS t\n    ON t.team_api_id = m.home_team_api_id\n  GROUP BY\n    l.name,\n    t.team_api_id,\n    t.team_long_name\n\n  UNION ALL\n\n  SELECT\n    l.name AS league_name,\n    t.team_api_id,\n    t.team_long_name,\n    SUM(\n      CASE\n        WHEN m.away_team_goal > m.home_team_goal THEN 1\n        ELSE 0\n      END\n    ) AS total_wins\n  FROM League AS l\n  INNER JOIN Match AS m\n    ON m.league_id = l.id\n  INNER JOIN Team AS t\n    ON t.team_api_id = m.away_team_api_id\n  GROUP BY\n    l.name,\n    t.team_api_id,\n    t.team_long_name\n),\nwins_by_team AS (\n  SELECT\n    league_name,\n    team_api_id,\n    team_long_name,\n    SUM(total_wins) AS total_wins\n  FROM team_wins\n  GROUP BY\n    league_name,\n    team_api_id,\n    team_long_name\n),\nranked AS (\n  SELECT\n    league_name,\n    team_long_name,\n    total_wins,\n    ROW_NUMBER() OVER (\n      PARTITION BY league_name\n      ORDER BY total_wins ASC, team_long_name ASC\n    ) AS rn\n  FROM wins_by_team\n)\nSELECT\n  league_name,\n  team_long_name\nFROM ranked\nWHERE rn = 1;\t----- bird -----\tEU_soccer_spider2",
    "96": "SELECT\n  t.team_long_name\nFROM Match AS m\nINNER JOIN Team AS t\n  ON m.home_team_api_id = t.team_api_id\nWHERE m.home_team_goal > m.away_team_goal\nGROUP BY t.team_api_id, t.team_long_name\nORDER BY COUNT(m.home_team_api_id) DESC\nLIMIT 10;\t----- bird -----\tEU_soccer_spider2",
    "97": "WITH match_outcomes AS (\n  SELECT\n    id AS match_id,\n    date,\n    CASE\n      WHEN home_team_goal > away_team_goal THEN home_team_api_id\n      WHEN away_team_goal > home_team_goal THEN away_team_api_id\n      ELSE NULL\n    END AS winner_team_api_id,\n    CASE\n      WHEN home_team_goal < away_team_goal THEN home_team_api_id\n      WHEN away_team_goal < home_team_goal THEN away_team_api_id\n      ELSE NULL\n    END AS loser_team_api_id\n  FROM Match\n  WHERE home_team_goal IS NOT NULL\n    AND away_team_goal IS NOT NULL\n    AND home_team_goal <> away_team_goal   -- exclude draws\n),\nplayer_match_participation AS (\n  -- home players\n  SELECT\n    mo.match_id,\n    mo.winner_team_api_id,\n    mo.loser_team_api_id,\n    p.player_name,\n    mo.date\n  FROM match_outcomes mo\n  INNER JOIN Match m ON m.id = mo.match_id\n  INNER JOIN Player p ON p.player_api_id IN (\n    m.home_player_1, m.home_player_2, m.home_player_3, m.home_player_4, m.home_player_5, m.home_player_6,\n    m.home_player_7, m.home_player_8, m.home_player_9, m.home_player_10, m.home_player_11\n  )\n  WHERE p.player_api_id IS NOT NULL\n\n  UNION ALL\n\n  -- away players\n  SELECT\n    mo.match_id,\n    mo.winner_team_api_id,\n    mo.loser_team_api_id,\n    p.player_name,\n    mo.date\n  FROM match_outcomes mo\n  INNER JOIN Match m ON m.id = mo.match_id\n  INNER JOIN Player p ON p.player_api_id IN (\n    m.away_player_1, m.away_player_2, m.away_player_3, m.away_player_4, m.away_player_5, m.away_player_6,\n    m.away_player_7, m.away_player_8, m.away_player_9, m.away_player_10, m.away_player_11\n  )\n  WHERE p.player_api_id IS NOT NULL\n),\nwin_counts AS (\n  SELECT\n    player_name,\n    COUNT(*) AS win_matches\n  FROM player_match_participation\n  WHERE winner_team_api_id IS NOT NULL\n  GROUP BY player_name\n),\nlose_counts AS (\n  SELECT\n    player_name,\n    COUNT(*) AS lose_matches\n  FROM player_match_participation\n  WHERE loser_team_api_id IS NOT NULL\n  GROUP BY player_name\n),\ntop_winner AS (\n  SELECT player_name, win_matches\n  FROM win_counts\n  ORDER BY win_matches DESC\n  LIMIT 1\n),\ntop_loser AS (\n  SELECT player_name, lose_matches\n  FROM lose_counts\n  ORDER BY lose_matches DESC\n  LIMIT 1\n)\nSELECT\n  (SELECT player_name FROM top_winner) AS top_winning_player,\n  (SELECT win_matches FROM top_winner) AS winning_matches_count,\n  (SELECT player_name FROM top_loser) AS top_losing_player,\n  (SELECT lose_matches FROM top_loser) AS losing_matches_count;\t----- bird -----\tEU_soccer_spider2",
    "98": "WITH\n-- total wickets per season per bowler, excluding specified dismissal kinds\nbowler_wkts AS (\n  SELECT\n    m.season_id,\n    bb.bowler AS player_id,\n    COUNT(*) AS total_wickets\n  FROM wicket_taken wt\n  INNER JOIN match m\n    ON m.match_id = wt.match_id\n  INNER JOIN ball_by_ball bb\n    ON bb.match_id = wt.match_id\n   AND bb.innings_no = wt.innings_no\n   AND bb.over_id = wt.over_id\n   AND bb.ball_id = wt.ball_id\n  WHERE wt.kind_out NOT IN ('run out', 'hit wicket', 'retired hurt')\n  GROUP BY\n    m.season_id,\n    bb.bowler\n),\ntop_bowlers AS (\n  SELECT\n    season_id,\n    player_id,\n    total_wickets,\n    ROW_NUMBER() OVER (\n      PARTITION BY season_id\n      ORDER BY total_wickets DESC, player_id ASC\n    ) AS rn\n  FROM bowler_wkts\n),\n\n-- total runs per season per batsman\nbatsman_runs AS (\n  SELECT\n    m.season_id,\n    bb.striker AS player_id,\n    SUM(bs.runs_scored) AS total_runs\n  FROM batsman_scored bs\n  INNER JOIN match m\n    ON m.match_id = bs.match_id\n  INNER JOIN ball_by_ball bb\n    ON bb.match_id = bs.match_id\n   AND bb.innings_no = bs.innings_no\n   AND bb.over_id = bs.over_id\n   AND bb.ball_id = bs.ball_id\n  GROUP BY\n    m.season_id,\n    bb.striker\n),\ntop_batsmen AS (\n  SELECT\n    season_id,\n    player_id,\n    total_runs,\n    ROW_NUMBER() OVER (\n      PARTITION BY season_id\n      ORDER BY total_runs DESC, player_id ASC\n    ) AS rn\n  FROM batsman_runs\n)\n\nSELECT\n  b.season_id,\n  b.rn AS position,\n  b.player_id AS batsman_id,\n  b.total_runs,\n  w.player_id AS bowler_id,\n  w.total_wickets\nFROM top_batsmen b\nINNER JOIN top_bowlers w\n  ON w.season_id = b.season_id\n AND w.rn = b.rn\nWHERE b.rn <= 3\nORDER BY\n  b.season_id ASC,\n  b.rn ASC;\t----- bird -----\tIPL_spider2",
    "99": "WITH player_match_runs AS (\n  SELECT\n    bs.match_id,\n    bs.player_id,\n    SUM(bs.runs_scored) AS runs_scored\n  FROM batsman_scored AS bs\n  GROUP BY\n    bs.match_id,\n    bs.player_id\n),\npair_partnership AS (\n  SELECT\n    r1.match_id,\n    CASE\n      WHEN r1.runs_scored > r2.runs_scored THEN r1.player_id\n      WHEN r1.runs_scored < r2.runs_scored THEN r2.player_id\n      WHEN r1.player_id > r2.player_id THEN r1.player_id\n      ELSE r2.player_id\n    END AS player1_id,\n    CASE\n      WHEN r1.runs_scored > r2.runs_scored THEN r2.player_id\n      WHEN r1.runs_scored < r2.runs_scored THEN r1.player_id\n      WHEN r1.player_id > r2.player_id THEN r2.player_id\n      ELSE r1.player_id\n    END AS player2_id,\n    CASE\n      WHEN r1.runs_scored > r2.runs_scored THEN r1.runs_scored\n      WHEN r1.runs_scored < r2.runs_scored THEN r2.runs_scored\n      WHEN r1.player_id > r2.player_id THEN r1.runs_scored\n      ELSE r2.runs_scored\n    END AS player1_runs,\n    CASE\n      WHEN r1.runs_scored > r2.runs_scored THEN r2.runs_scored\n      WHEN r1.runs_scored < r2.runs_scored THEN r1.runs_scored\n      WHEN r1.player_id > r2.player_id THEN r2.runs_scored\n      ELSE r1.runs_scored\n    END AS player2_runs,\n    (r1.runs_scored + r2.runs_scored) AS partnership_runs\n  FROM player_match_runs AS r1\n  INNER JOIN player_match_runs AS r2\n    ON r1.match_id = r2.match_id\n   AND r1.player_id < r2.player_id\n),\nranked AS (\n  SELECT\n    pp.*,\n    DENSE_RANK() OVER (\n      PARTITION BY pp.match_id\n      ORDER BY pp.partnership_runs DESC\n    ) AS dr\n  FROM pair_partnership AS pp\n)\nSELECT\n  player1_id AS player1_player_id,\n  player2_id AS player2_player_id,\n  player1_runs AS player1_runs_scored,\n  player2_runs AS player2_runs_scored,\n  partnership_runs AS total_partnership_score\nFROM ranked\nWHERE dr = 1;\t----- bird -----\tIPL_spider2",
    "100": "WITH base AS (\n  SELECT\n    CAST(t.Milliseconds AS REAL) / 60000.0 AS minutes,\n    il.Quantity * t.UnitPrice AS revenue\n  FROM InvoiceLine AS il\n  INNER JOIN Track AS t\n    ON il.TrackId = t.TrackId\n),\nstats AS (\n  SELECT\n    MIN(minutes) AS min_minutes,\n    AVG(minutes) AS avg_minutes,\n    MAX(minutes) AS max_minutes\n  FROM base\n),\nbounds AS (\n  SELECT\n    min_minutes,\n    avg_minutes,\n    max_minutes,\n    (min_minutes + avg_minutes) / 2.0 AS mid_min_avg,\n    (avg_minutes + max_minutes) / 2.0 AS mid_avg_max\n  FROM stats\n),\nlabeled AS (\n  SELECT\n    CASE\n      WHEN b.minutes BETWEEN bo.min_minutes AND bo.mid_min_avg THEN 'short'\n      WHEN b.minutes BETWEEN bo.mid_min_avg AND bo.mid_avg_max THEN 'medium'\n      WHEN b.minutes BETWEEN bo.mid_avg_max AND bo.max_minutes THEN 'long'\n    END AS category,\n    b.minutes,\n    b.revenue\n  FROM base AS b\n  CROSS JOIN bounds AS bo\n)\nSELECT\n  category,\n  MIN(minutes) AS min_time_minutes,\n  MAX(minutes) AS max_time_minutes,\n  SUM(revenue) AS total_revenue\nFROM labeled\nGROUP BY category\nORDER BY\n  CASE category\n    WHEN 'short' THEN 1\n    WHEN 'medium' THEN 2\n    WHEN 'long' THEN 3\n    ELSE 4\n  END;\t----- bird -----\tmusic_spider2",
    "101": "WITH cleaned AS (\n  SELECT\n    Location,\n    CompanyName,\n    CAST(\n      NULLIF(\n        REPLACE(\n          REPLACE(\n            REPLACE(\n              REPLACE(\n                REPLACE(\n                  REPLACE(\n                    REPLACE(\n                      REPLACE(\n                        REPLACE(\n                          REPLACE(LOWER(Salary), '\u20b9', ''),\n                        ',', ''),\n                      'per annum', ''),\n                    'per year', ''),\n                  'pa', ''),\n                'p.a.', ''),\n              'lpa', ''),\n            'lakh', ''),\n          'lakhs', ''),\n        ' ', ''\n      ) AS REAL\n    ) AS salary_num\n  FROM SalaryDataset\n),\ncountry_avg AS (\n  SELECT AVG(salary_num) AS avg_salary_country\n  FROM cleaned\n  WHERE salary_num IS NOT NULL\n),\ncompany_city_avg AS (\n  SELECT\n    Location,\n    CompanyName,\n    AVG(salary_num) AS avg_salary_state\n  FROM cleaned\n  WHERE salary_num IS NOT NULL\n    AND Location IN ('Mumbai', 'Pune', 'New Delhi', 'Hyderabad')\n  GROUP BY Location, CompanyName\n),\nranked AS (\n  SELECT\n    Location,\n    CompanyName,\n    avg_salary_state,\n    ROW_NUMBER() OVER (\n      PARTITION BY Location\n      ORDER BY avg_salary_state DESC\n    ) AS rn\n  FROM company_city_avg\n)\nSELECT\n  r.Location AS \"Location\",\n  r.CompanyName AS \"Company Name\",\n  r.avg_salary_state AS \"Average Salary in State\",\n  c.avg_salary_country AS \"Average Salary in Country\"\nFROM ranked r\nINNER JOIN country_avg c\nWHERE r.rn <= 5\nORDER BY\n  r.Location,\n  r.avg_salary_state DESC,\n  r.CompanyName;\t----- bird -----\teducation_business_spider2",
    "102": "WITH bowler_match AS (\n  SELECT\n    bb.bowler AS bowler_id,\n    bb.match_id,\n    COUNT(wt.player_out) AS wickets,\n    COALESCE(SUM(bs.runs_scored), 0) AS runs_conceded_off_bat,\n    COUNT(bb.ball_id) AS balls_bowled\n  FROM ball_by_ball AS bb\n  LEFT JOIN wicket_taken AS wt\n    ON wt.match_id = bb.match_id\n   AND wt.innings_no = bb.innings_no\n   AND wt.over_id = bb.over_id\n   AND wt.ball_id = bb.ball_id\n   AND wt.kind_out NOT IN ('run out', 'retired hurt', 'obstructing the field')\n  LEFT JOIN batsman_scored AS bs\n    ON bs.match_id = bb.match_id\n   AND bs.innings_no = bb.innings_no\n   AND bs.over_id = bb.over_id\n   AND bs.ball_id = bb.ball_id\n  GROUP BY\n    bb.bowler,\n    bb.match_id\n),\nbowler_totals AS (\n  SELECT\n    bowler_id,\n    SUM(wickets) AS total_wickets,\n    SUM(runs_conceded_off_bat) AS total_runs_conceded_off_bat,\n    SUM(balls_bowled) AS total_balls\n  FROM bowler_match\n  GROUP BY bowler_id\n),\nbest_match AS (\n  SELECT\n    bm.bowler_id,\n    bm.wickets AS best_wickets,\n    bm.runs_conceded_off_bat AS best_runs,\n    ROW_NUMBER() OVER (\n      PARTITION BY bm.bowler_id\n      ORDER BY bm.wickets DESC, bm.runs_conceded_off_bat ASC, bm.match_id ASC\n    ) AS rn\n  FROM bowler_match AS bm\n)\nSELECT\n  p.player_name AS bowler,\n  bt.total_wickets AS wickets,\n  (bt.total_runs_conceded_off_bat * 1.0) / (bt.total_balls / 6.0) AS economy_rate,\n  (bt.total_balls * 1.0) / NULLIF(bt.total_wickets, 0) AS strike_rate,\n  CAST(bm.best_wickets AS TEXT) || '-' || CAST(bm.best_runs AS TEXT) AS best_bowling_performance\nFROM bowler_totals AS bt\nINNER JOIN player AS p\n  ON p.player_id = bt.bowler_id\nINNER JOIN best_match AS bm\n  ON bm.bowler_id = bt.bowler_id\n AND bm.rn = 1\nORDER BY bt.total_wickets DESC, economy_rate ASC;\t----- bird -----\tIPL_spider2",
    "103": "WITH player_match AS (\n  SELECT\n    p.player_id,\n    p.player_name,\n    p.role,\n    p.batting_hand,\n    p.bowling_skill,\n    p.runs,\n    p.dismissed,\n    p.score,\n    p.balls_faced,\n    p.wickets,\n    p.runs_conceded,\n    p.balls_bowled,\n    m.match_date,\n    m.match_id\n  FROM player AS p\n  INNER JOIN match AS m\n    ON p.match_id = m.match_id\n),\nrole_ranked AS (\n  SELECT\n    player_id,\n    role,\n    COUNT(*) AS role_cnt,\n    ROW_NUMBER() OVER (\n      PARTITION BY player_id\n      ORDER BY COUNT(*) DESC, role\n    ) AS rn\n  FROM player_match\n  GROUP BY player_id, role\n),\nbat_agg AS (\n  SELECT\n    player_id,\n    SUM(runs) AS total_runs,\n    COUNT(DISTINCT match_id) AS total_matches,\n    SUM(CASE WHEN dismissed = 1 THEN 1 ELSE 0 END) AS total_dismissals,\n    MAX(score) AS highest_score,\n    SUM(CASE WHEN runs >= 30 THEN 1 ELSE 0 END) AS matches_30_plus,\n    SUM(CASE WHEN runs >= 50 THEN 1 ELSE 0 END) AS matches_50_plus,\n    SUM(CASE WHEN runs >= 100 THEN 1 ELSE 0 END) AS matches_100_plus,\n    SUM(balls_faced) AS total_balls_faced\n  FROM player_match\n  GROUP BY player_id\n),\nbowl_match AS (\n  SELECT\n    player_id,\n    match_id,\n    SUM(wickets) AS match_wkts,\n    SUM(runs_conceded) AS match_runs_given\n  FROM player_match\n  GROUP BY player_id, match_id\n),\nbest_bowl AS (\n  SELECT\n    player_id,\n    match_wkts,\n    match_runs_given,\n    ROW_NUMBER() OVER (\n      PARTITION BY player_id\n      ORDER BY match_wkts DESC, match_runs_given ASC\n    ) AS rn\n  FROM bowl_match\n),\nbowl_agg AS (\n  SELECT\n    player_id,\n    SUM(wickets) AS total_wickets,\n    SUM(runs_conceded) AS total_runs_conceded,\n    SUM(balls_bowled) AS total_balls_bowled\n  FROM player_match\n  GROUP BY player_id\n)\nSELECT\n  pm.player_id,\n  pm.player_name,\n  rr.role AS most_frequent_role,\n  pm.batting_hand,\n  pm.bowling_skill,\n  ba.total_runs,\n  ba.total_matches,\n  ba.total_dismissals,\n  CASE\n    WHEN ba.total_dismissals = 0 THEN NULL\n    ELSE CAST(ba.total_runs AS REAL) / ba.total_dismissals\n  END AS batting_average,\n  ba.highest_score,\n  ba.matches_30_plus,\n  ba.matches_50_plus,\n  ba.matches_100_plus,\n  ba.total_balls_faced,\n  CASE\n    WHEN ba.total_balls_faced = 0 THEN NULL\n    ELSE (CAST(ba.total_runs AS REAL) / ba.total_balls_faced) * 100.0\n  END AS strike_rate,\n  bo.total_wickets,\n  CASE\n    WHEN bo.total_balls_bowled = 0 THEN NULL\n    ELSE (CAST(bo.total_runs_conceded AS REAL) / bo.total_balls_bowled) * 6.0\n  END AS economy_rate,\n  (CAST(bb.match_wkts AS TEXT) || '-' || CAST(bb.match_runs_given AS TEXT)) AS best_bowling_performance\nFROM (SELECT DISTINCT player_id, player_name, batting_hand, bowling_skill FROM player_match) AS pm\nINNER JOIN role_ranked AS rr\n  ON rr.player_id = pm.player_id AND rr.rn = 1\nINNER JOIN bat_agg AS ba\n  ON ba.player_id = pm.player_id\nINNER JOIN bowl_agg AS bo\n  ON bo.player_id = pm.player_id\nLEFT JOIN best_bowl AS bb\n  ON bb.player_id = pm.player_id AND bb.rn = 1\nORDER BY pm.player_id;\t----- bird -----\tIPL_spider2",
    "104": "WITH stack_scores AS (\n  SELECT\n    ms.name,\n    ms.version,\n    ms.step,\n    ms.test_score AS stack_test_score\n  FROM model_score AS ms\n  WHERE ms.model = 'Stack'\n    AND ms.step IN (1, 2, 3)\n),\nnonstack_max AS (\n  SELECT\n    ms.name,\n    ms.version,\n    ms.step,\n    MAX(ms.test_score) AS nonstack_max_test_score\n  FROM model_score AS ms\n  WHERE ms.model <> 'Stack'\n    AND ms.step IN (1, 2, 3)\n  GROUP BY\n    ms.name, ms.version, ms.step\n),\nqualified AS (\n  SELECT\n    n.name\n  FROM nonstack_max AS n\n  INNER JOIN stack_scores AS s\n    ON s.name = n.name\n   AND s.version = n.version\n   AND s.step = n.step\n  WHERE n.nonstack_max_test_score < s.stack_test_score\n),\nsolution_counts AS (\n  SELECT\n    sol.name,\n    COUNT(*) AS solution_occurrences\n  FROM solution AS sol\n  GROUP BY sol.name\n),\nqualified_counts AS (\n  SELECT\n    q.name,\n    COUNT(*) AS qualified_occurrences\n  FROM qualified AS q\n  GROUP BY q.name\n)\nSELECT\n  qc.name\nFROM qualified_counts AS qc\nINNER JOIN solution_counts AS sc\n  ON sc.name = qc.name\nWHERE qc.qualified_occurrences > sc.solution_occurrences;\t----- bird -----\tstacking_spider2",
    "105": "WITH per_model_step AS (\n  SELECT\n    m.name AS model_name,\n    m.version AS model_version,\n    m.L1_model AS L1_model,\n    ms.step AS step,\n    MAX(CASE WHEN m.name = 'Stack' THEN ms.test_score END) AS stack_score,\n    MAX(CASE WHEN m.name <> 'Stack' THEN ms.test_score END) AS non_stack_max_score\n  FROM model_score AS ms\n  INNER JOIN model AS m\n    ON ms.model = m.name\n   AND ms.version = m.version\n  GROUP BY\n    m.name, m.version, m.L1_model, ms.step\n),\nmodel_status AS (\n  SELECT\n    model_name,\n    model_version,\n    L1_model,\n    CASE\n      WHEN MAX(CASE WHEN non_stack_max_score < stack_score THEN 1 ELSE 0 END) = 1 THEN 'strong'\n      WHEN MAX(CASE WHEN non_stack_max_score = stack_score THEN 1 ELSE 0 END) = 1 THEN 'soft'\n      ELSE NULL\n    END AS status\n  FROM per_model_step\n  GROUP BY model_name, model_version, L1_model\n),\nl1_counts AS (\n  SELECT\n    status,\n    L1_model,\n    COUNT(*) AS occurrences\n  FROM model_status\n  WHERE status IN ('strong', 'soft')\n  GROUP BY status, L1_model\n),\nranked AS (\n  SELECT\n    status,\n    L1_model,\n    occurrences,\n    ROW_NUMBER() OVER (\n      PARTITION BY status\n      ORDER BY occurrences DESC, L1_model\n    ) AS rn\n  FROM l1_counts\n)\nSELECT\n  status,\n  L1_model,\n  occurrences\nFROM ranked\nWHERE rn = 1\nORDER BY status;\t----- bird -----\tstacking_spider2",
    "106": "SELECT\n  L1_model,\n  COUNT(*) AS total_count\nFROM model\nWHERE L1_model IN ('Stack', 'Traditional')\nGROUP BY L1_model\nORDER BY total_count DESC\nLIMIT 1;\t----- bird -----\tstacking_spider2",
    "107": "WITH RECURSIVE expanded AS (\n  -- Start from each top-level packaging and expand its contents\n  SELECT\n    pr.packaging_id AS root_packaging_id,\n    pr.contains_id  AS current_packaging_id,\n    pr.qty          AS qty\n  FROM packaging_relations AS pr\n\n  UNION ALL\n\n  -- If a contained item is itself a packaging, expand it further\n  SELECT\n    e.root_packaging_id,\n    pr.contains_id,\n    e.qty * pr.qty\n  FROM expanded AS e\n  INNER JOIN packaging_relations AS pr\n    ON pr.packaging_id = e.current_packaging_id\n),\nleaf_items AS (\n  -- Keep only leaf-level items (those that do not contain anything else)\n  SELECT\n    e.root_packaging_id,\n    e.current_packaging_id,\n    e.qty\n  FROM expanded AS e\n  LEFT JOIN packaging_relations AS pr2\n    ON pr2.packaging_id = e.current_packaging_id\n  WHERE pr2.packaging_id IS NULL\n),\ntotals AS (\n  -- Total leaf-level quantity per final (root) packaging combination\n  SELECT\n    root_packaging_id,\n    SUM(qty) AS total_qty\n  FROM leaf_items\n  GROUP BY root_packaging_id\n)\nSELECT\n  AVG(total_qty) AS avg_total_quantity\nFROM totals;\t----- bird -----\toracle_sql_spider2",
    "108": "SELECT\n  p_top.name AS packaging_name,\n  prd.name AS product_name\nFROM packaging AS p_top\nINNER JOIN packaging_relations AS r1\n  ON r1.packaging_id = p_top.id\nINNER JOIN packaging AS p_child\n  ON p_child.id = r1.contains_id\nINNER JOIN packaging_relations AS r2\n  ON r2.packaging_id = p_child.id\nINNER JOIN products AS prd\n  ON prd.id = r2.contains_id\nWHERE p_top.id NOT IN (\n  SELECT contains_id\n  FROM packaging_relations\n)\nGROUP BY\n  p_top.id,\n  p_top.name,\n  prd.id,\n  prd.name\nHAVING SUM(r1.qty * r2.qty) > 500;\t----- bird -----\toracle_sql_spider2",
    "109": "SELECT\n  inv.product_id,\n  loc.aisle,\n  loc.position\nFROM orderlines AS ol\nINNER JOIN orders AS o\n  ON o.id = ol.order_id\nINNER JOIN inventory AS inv\n  ON inv.product_id = ol.product_id\nINNER JOIN locations AS loc\n  ON loc.id = inv.location_id\nWHERE o.id = 423\n  AND loc.warehouse = 1\n  AND inv.qty > 0\nORDER BY\n  inv.purchase_id ASC,\n  inv.qty ASC,\n  inv.product_id ASC,\n  loc.aisle ASC,\n  loc.position ASC;\t----- bird -----\toracle_sql_spider2",
    "110": "SELECT\n  p.name AS product_name,\n  AVG(CAST(pl.qty AS REAL) * 100.0 / i.qty) AS avg_pick_percentage\nFROM inventory AS i\nINNER JOIN purchases AS pu\n  ON i.purchase_id = pu.id\nINNER JOIN products AS p\n  ON i.product_id = p.id\nINNER JOIN picking_line AS pl\n  ON pl.product_id = p.id\n AND pl.location_id = i.location_id\nORDER BY\n  i.purchase_id ASC,\n  i.qty ASC\nGROUP BY\n  p.name\nORDER BY\n  p.name ASC;\t----- bird -----\toracle_sql_spider2",
    "111": "SELECT\n  products.name,\n  AVG(picking_line.qty) AS avg_units_picked\nFROM picking_line\nINNER JOIN products\n  ON picking_line.product_id = products.id\nWHERE picking_line.order_id = 421\nGROUP BY picking_line.product_id, products.name\nORDER BY picking_line.picklist_id, picking_line.location_id\nLIMIT 1;\t----- bird -----\toracle_sql_spider2",
    "112": "WITH base AS (\n  SELECT\n    ms.product_id,\n    ms.mth,\n    ms.qty,\n    ROW_NUMBER() OVER (\n      PARTITION BY ms.product_id\n      ORDER BY ms.mth\n    ) AS rn\n  FROM monthly_sales AS ms\n  WHERE ms.mth >= '2016-01-01'\n    AND ms.mth <  '2018-01-01'\n),\ncma_calc AS (\n  SELECT\n    b.product_id,\n    b.mth,\n    b.qty,\n    b.rn,\n    (\n      (\n        AVG(b.qty) OVER (\n          PARTITION BY b.product_id\n          ORDER BY b.mth\n          ROWS BETWEEN 5 PRECEDING AND 6 FOLLOWING\n        )\n        +\n        AVG(b.qty) OVER (\n          PARTITION BY b.product_id\n          ORDER BY b.mth\n          ROWS BETWEEN 6 PRECEDING AND 5 FOLLOWING\n        )\n      ) / 2.0\n    ) AS cma\n  FROM base AS b\n),\nratio_2017 AS (\n  SELECT\n    product_id,\n    mth,\n    rn,\n    qty,\n    cma,\n    (qty * 1.0 / NULLIF(cma, 0)) AS sales_to_cma_ratio\n  FROM cma_calc\n  WHERE rn BETWEEN 7 AND 30\n    AND mth >= '2017-01-01'\n    AND mth <  '2018-01-01'\n)\nSELECT\n  product_id\nFROM ratio_2017\nGROUP BY product_id\nHAVING COUNT(mth) = 12\n   AND MIN(sales_to_cma_ratio) > 2;\t----- bird -----\toracle_sql_spider2",
    "113": "SELECT\n  CAST(SUM(ms.qty) AS REAL) / COUNT(ms.qty) AS avg_qty\nFROM monthly_sales AS ms\nWHERE ms.mth >= '2016-01'\n  AND ms.mth < '2018-01'\n  AND ms.product_id IN (4160, 7790)\n  AND ms.mth BETWEEN 7 AND 30;\t----- bird -----\toracle_sql_spider2",
    "114": "SELECT\n  pm.product_id,\n  i.date AS month,\n  ABS(i.qty - pm.qty_minimum) AS abs_diff\nFROM inventory AS i\nINNER JOIN product_minimums AS pm\n  ON i.product_id = pm.product_id\nWHERE i.date BETWEEN '2018-12-01' AND '2019-12-31'\nORDER BY ABS(i.qty - pm.qty_minimum) ASC\nLIMIT 1;\t----- bird -----\toracle_sql_spider2",
    "115": "WITH match_points AS (\n  SELECT\n    m.season,\n    l.name AS league_name,\n    c.name AS country_name,\n    t_home.team_long_name AS team_name,\n    CASE\n      WHEN m.home_team_goal > m.away_team_goal THEN 3\n      WHEN m.home_team_goal = m.away_team_goal THEN 1\n      ELSE 0\n    END AS points\n  FROM Match AS m\n  INNER JOIN League AS l\n    ON m.league_id = l.id\n  INNER JOIN Country AS c\n    ON l.country_id = c.id\n  INNER JOIN Team AS t_home\n    ON m.home_team_api_id = t_home.team_api_id\n\n  UNION ALL\n\n  SELECT\n    m.season,\n    l.name AS league_name,\n    c.name AS country_name,\n    t_away.team_long_name AS team_name,\n    CASE\n      WHEN m.away_team_goal > m.home_team_goal THEN 3\n      WHEN m.away_team_goal = m.home_team_goal THEN 1\n      ELSE 0\n    END AS points\n  FROM Match AS m\n  INNER JOIN League AS l\n    ON m.league_id = l.id\n  INNER JOIN Country AS c\n    ON l.country_id = c.id\n  INNER JOIN Team AS t_away\n    ON m.away_team_api_id = t_away.team_api_id\n),\nteam_season_points AS (\n  SELECT\n    season,\n    league_name,\n    country_name,\n    team_name,\n    SUM(points) AS total_points\n  FROM match_points\n  GROUP BY\n    season, league_name, country_name, team_name\n),\nranked AS (\n  SELECT\n    season,\n    team_name,\n    league_name,\n    country_name,\n    total_points,\n    ROW_NUMBER() OVER (\n      PARTITION BY season, league_name, country_name\n      ORDER BY total_points DESC\n    ) AS rn\n  FROM team_season_points\n)\nSELECT\n  season,\n  team_name,\n  league_name,\n  country_name,\n  total_points\nFROM ranked\nWHERE rn = 1\nORDER BY season, country_name, league_name;\t----- bird -----\tEU_soccer_spider2",
    "116": "WITH item_avg AS (\n  SELECT\n    item_code,\n    AVG(\"loss_rate_%\") AS item_avg_loss_rate\n  FROM veg_loss_rate_df\n  GROUP BY item_code\n),\nstats AS (\n  SELECT\n    AVG(item_avg_loss_rate) AS avg_loss_rate,\n    -- SQLite doesn't have STDDEV built-in; compute population stddev as sqrt(E[x^2] - (E[x])^2)\n    SQRT(AVG(item_avg_loss_rate * item_avg_loss_rate) - AVG(item_avg_loss_rate) * AVG(item_avg_loss_rate)) AS std_loss_rate\n  FROM item_avg\n)\nSELECT\n  SUM(CASE WHEN ia.item_avg_loss_rate < (s.avg_loss_rate - s.std_loss_rate) THEN 1 ELSE 0 END) AS below_one_std_count,\n  SUM(CASE WHEN ia.item_avg_loss_rate > (s.avg_loss_rate + s.std_loss_rate) THEN 1 ELSE 0 END) AS above_one_std_count,\n  SUM(CASE\n        WHEN ia.item_avg_loss_rate >= (s.avg_loss_rate - s.std_loss_rate)\n         AND ia.item_avg_loss_rate <= (s.avg_loss_rate + s.std_loss_rate)\n        THEN 1 ELSE 0\n      END) AS within_one_std_count,\n  s.avg_loss_rate AS average_loss_rate\nFROM item_avg AS ia\nINNER JOIN stats AS s ON 1 = 1;\t----- bird -----\tbank_sales_trading_spider2",
    "117": "WITH whsle_year_cat AS (\n  SELECT\n    CAST(strftime('%Y', w.whsle_date) AS INTEGER) AS year,\n    c.category_name AS category_name,\n    AVG(w.\"whsle_px_rmb-kg\") AS avg_whsle_price,\n    MAX(w.\"whsle_px_rmb-kg\") AS max_whsle_price,\n    MIN(w.\"whsle_px_rmb-kg\") AS min_whsle_price,\n    SUM(w.\"whsle_px_rmb-kg\") AS total_whsle_price\n  FROM veg_whsle_df AS w\n  INNER JOIN veg_cat AS c\n    ON c.item_code = w.item_code\n  WHERE CAST(strftime('%Y', w.whsle_date) AS INTEGER) BETWEEN 2020 AND 2023\n  GROUP BY\n    CAST(strftime('%Y', w.whsle_date) AS INTEGER),\n    c.category_name\n),\nsell_year_cat AS (\n  SELECT\n    CAST(strftime('%Y', t.txn_date) AS INTEGER) AS year,\n    c.category_name AS category_name,\n    SUM(t.\"unit_selling_px_rmb/kg\" * t.\"qty_sold(kg)\") AS total_selling_price\n  FROM veg_txn_df AS t\n  INNER JOIN veg_cat AS c\n    ON c.item_code = t.item_code\n  WHERE CAST(strftime('%Y', t.txn_date) AS INTEGER) BETWEEN 2020 AND 2023\n  GROUP BY\n    CAST(strftime('%Y', t.txn_date) AS INTEGER),\n    c.category_name\n),\nloss_year_cat AS (\n  SELECT\n    CAST(strftime('%Y', t.txn_date) AS INTEGER) AS year,\n    c.category_name AS category_name,\n    AVG(l.\"loss_rate_%\") AS avg_loss_rate,\n    SUM(t.\"qty_sold(kg)\" * (l.\"loss_rate_%\"/100.0)) AS total_loss\n  FROM veg_txn_df AS t\n  INNER JOIN veg_cat AS c\n    ON c.item_code = t.item_code\n  INNER JOIN veg_loss_rate_df AS l\n    ON l.item_code = t.item_code\n  WHERE CAST(strftime('%Y', t.txn_date) AS INTEGER) BETWEEN 2020 AND 2023\n  GROUP BY\n    CAST(strftime('%Y', t.txn_date) AS INTEGER),\n    c.category_name\n)\nSELECT\n  w.year AS year,\n  w.category_name AS category_name,\n  ROUND(w.avg_whsle_price, 2) AS avg_wholesale_price,\n  ROUND(w.max_whsle_price, 2) AS max_wholesale_price,\n  ROUND(w.min_whsle_price, 2) AS min_wholesale_price,\n  ROUND(w.max_whsle_price - w.min_whsle_price, 2) AS wholesale_price_difference,\n  ROUND(w.total_whsle_price, 2) AS total_wholesale_price,\n  ROUND(COALESCE(s.total_selling_price, 0.0), 2) AS total_selling_price,\n  ROUND(COALESCE(l.avg_loss_rate, 0.0), 2) AS average_loss_rate,\n  ROUND(COALESCE(l.total_loss, 0.0), 2) AS total_loss,\n  ROUND(COALESCE(s.total_selling_price, 0.0) - w.total_whsle_price, 2) AS profit\nFROM whsle_year_cat AS w\nINNER JOIN sell_year_cat AS s\n  ON s.year = w.year AND s.category_name = w.category_name\nINNER JOIN loss_year_cat AS l\n  ON l.year = w.year AND l.category_name = w.category_name\nORDER BY\n  w.year,\n  w.category_name;\t----- bird -----\tbank_sales_trading_spider2",
    "118": "WITH seller_filtered AS (\n  SELECT\n    oi.seller_id\n  FROM order_items AS oi\n  GROUP BY\n    oi.seller_id\n  HAVING\n    COUNT(oi.product_id) > 100\n),\nseller_metrics AS (\n  SELECT\n    oi.seller_id,\n    SUM(oi.price) AS total_sales,\n    AVG(oi.price) AS avg_item_price,\n    AVG(r.review_score) AS avg_review_score,\n    AVG(\n      julianday(oi.shipping_limit_date) - julianday(o.order_purchase_timestamp)\n    ) AS avg_packing_time_days\n  FROM order_items AS oi\n  INNER JOIN seller_filtered AS sf\n    ON sf.seller_id = oi.seller_id\n  INNER JOIN orders AS o\n    ON o.order_id = oi.order_id\n  INNER JOIN order_reviews AS r\n    ON r.order_id = oi.order_id\n  GROUP BY\n    oi.seller_id\n),\ntop_category AS (\n  SELECT\n    t.product_category_name_english\n  FROM order_items AS oi\n  INNER JOIN products AS p\n    ON p.product_id = oi.product_id\n  INNER JOIN product_category_name_translation AS t\n    ON t.product_category_name = p.product_category_name\n  GROUP BY\n    t.product_category_name_english\n  ORDER BY\n    COUNT(oi.product_id) DESC\n  LIMIT 1\n)\nSELECT\n  sm.seller_id,\n  sm.total_sales,\n  sm.avg_item_price,\n  sm.avg_review_score,\n  sm.avg_packing_time_days,\n  tc.product_category_name_english AS highest_sales_volume_category_english\nFROM seller_metrics AS sm\nCROSS JOIN top_category AS tc;\t----- bird -----\telectronic_sales_spider2",
    "119": "WITH base AS (\n  SELECT\n    calendar_year,\n    week_date,\n    sales\n  FROM cleaned_weekly_sales\n  WHERE calendar_year IN (2018, 2019, 2020)\n),\npre AS (\n  -- 4 weeks leading up to June 15: [June 15 - 28 days, June 15)\n  SELECT\n    calendar_year,\n    SUM(sales) AS pre_sales\n  FROM base\n  WHERE week_date >= date(calendar_year || '-06-15', '-28 days')\n    AND week_date <  date(calendar_year || '-06-15')\n  GROUP BY calendar_year\n),\npost AS (\n  -- 4 weeks following June 15: [June 15, June 15 + 28 days)\n  SELECT\n    calendar_year,\n    SUM(sales) AS post_sales\n  FROM base\n  WHERE week_date >= date(calendar_year || '-06-15')\n    AND week_date <  date(calendar_year || '-06-15', '+28 days')\n  GROUP BY calendar_year\n)\nSELECT\n  pre.calendar_year,\n  ROUND(\n    (post.post_sales - pre.pre_sales) * 100.0 / NULLIF(pre.pre_sales, 0),\n    2\n  ) AS pct_change_sales\nFROM pre\nINNER JOIN post\n  ON pre.calendar_year = post.calendar_year\nORDER BY pre.calendar_year;\t----- bird -----\tbank_sales_trading_spider2",
    "120": "\t----- bird -----\tbank_sales_trading_spider2",
    "121": "SELECT COUNT(DISTINCT i.session) AS unique_sessions\nFROM form_log AS i\nINNER JOIN form_log AS c\n  ON i.session = c.session\n AND i.stamp < c.stamp\nWHERE i.path = '/regist/input'\n  AND c.path = '/regist/confirm';\t----- bird -----\tlog_spider2",
    "122": "WITH session_path_counts AS (\n  SELECT\n    session,\n    COUNT(path) AS path_cnt\n  FROM activity_log\n  WHERE path IS NOT NULL\n  GROUP BY session\n)\nSELECT\n  COUNT(*) AS session_count\nFROM session_path_counts\nWHERE path_cnt >= 2;\t----- bird -----\tlog_spider2",
    "123": "WITH detail_streaks AS (\n  SELECT\n    session,\n    stamp,\n    path,\n    LAG(path, 1) OVER (PARTITION BY session ORDER BY stamp) AS prev_path,\n    LEAD(path, 1) OVER (PARTITION BY session ORDER BY stamp) AS next_path\n  FROM form_log\n),\nthird_page_visits AS (\n  SELECT\n    next_path AS third_path\n  FROM detail_streaks\n  WHERE path = '/detail'\n    AND prev_path = '/detail'\n    AND next_path IS NOT NULL\n)\nSELECT\n  third_path AS path,\n  COUNT(*) AS count\nFROM third_page_visits\nGROUP BY third_path\nORDER BY count DESC\nLIMIT 3;\t----- bird -----\tlog_spider2",
    "124": "WITH users_with_age AS (\n  SELECT\n    mst_users.user_id,\n    (CAST(strftime('%Y', 'now') AS INTEGER) - CAST(strftime('%Y', mst_users.birth_date) AS INTEGER)) AS age\n  FROM mst_users\n  WHERE mst_users.birth_date IS NOT NULL\n),\nusers_with_category AS (\n  SELECT\n    CASE\n      WHEN age BETWEEN 20 AND 29 THEN '20s'\n      WHEN age BETWEEN 30 AND 39 THEN '30s'\n      WHEN age BETWEEN 40 AND 49 THEN '40s'\n      WHEN age BETWEEN 50 AND 59 THEN '50s'\n      ELSE 'others'\n    END AS age_category,\n    user_id\n  FROM users_with_age\n)\nSELECT\n  age_category,\n  COUNT(user_id) AS user_count\nFROM users_with_category\nGROUP BY age_category\nORDER BY\n  CASE age_category\n    WHEN '20s' THEN 1\n    WHEN '30s' THEN 2\n    WHEN '40s' THEN 3\n    WHEN '50s' THEN 4\n    ELSE 5\n  END;\t----- bird -----\tlog_spider2",
    "125": "WITH first_target AS (\n  SELECT\n    session,\n    MIN(stamp) AS first_stamp\n  FROM activity_log\n  WHERE action IN ('detail', 'complete')\n  GROUP BY session\n),\npre_events AS (\n  SELECT\n    a.session,\n    a.path,\n    a.search_type\n  FROM activity_log AS a\n  INNER JOIN first_target AS f\n    ON a.session = f.session\n  WHERE a.search_type IS NOT NULL\n    AND a.search_type <> ''\n    AND a.stamp < f.first_stamp\n),\nsession_counts AS (\n  SELECT\n    session,\n    COUNT(*) AS pre_cnt\n  FROM pre_events\n  GROUP BY session\n),\nmin_cnt AS (\n  SELECT MIN(pre_cnt) AS min_pre_cnt\n  FROM session_counts\n)\nSELECT\n  p.session,\n  p.path,\n  p.search_type\nFROM pre_events AS p\nINNER JOIN session_counts AS c\n  ON p.session = c.session\nINNER JOIN min_cnt AS m\n  ON c.pre_cnt = m.min_pre_cnt;\t----- bird -----\tlog_spider2",
    "126": "SELECT\n  COUNT(*) AS count\nFROM races_ext\nINNER JOIN lap_positions\n  ON lap_positions.race_id = races_ext.race_id\nINNER JOIN pit_stops\n  ON pit_stops.race_id = lap_positions.race_id\n AND pit_stops.lap = lap_positions.lap\nINNER JOIN retirements\n  ON retirements.race_id = lap_positions.race_id\n AND retirements.driver_id = pit_stops.driver_id\nWHERE races_ext.is_pit_data_available = 1\n  AND lap_positions.lap_type = 'R';\t----- bird -----\tf1_spider2",
    "127": "WITH\novertakes AS (\n  -- Detect overtakes as position improvements between consecutive laps (within first 5 laps)\n  SELECT\n    lp_cur.race_id,\n    lp_cur.driver_id AS overtaking_driver_id,\n    lp_prev.position AS prev_position,\n    lp_cur.position  AS cur_position,\n    lp_cur.lap\n  FROM lap_positions AS lp_cur\n  INNER JOIN lap_positions AS lp_prev\n    ON lp_prev.race_id = lp_cur.race_id\n   AND lp_prev.driver_id = lp_cur.driver_id\n   AND lp_prev.lap = lp_cur.lap - 1\n  WHERE lp_cur.lap <= 5\n    AND lp_prev.position IS NOT NULL\n    AND lp_cur.position IS NOT NULL\n    AND lp_cur.position < lp_prev.position\n),\novertake_events AS (\n  -- Expand each position gain by N into N individual overtake events\n  WITH RECURSIVE nums(n) AS (\n    SELECT 1\n    UNION ALL\n    SELECT n + 1 FROM nums WHERE n < 50\n  )\n  SELECT\n    o.race_id,\n    o.overtaking_driver_id,\n    o.lap,\n    nums.n AS step\n  FROM overtakes AS o\n  INNER JOIN nums\n    ON nums.n <= (o.prev_position - o.cur_position)\n),\novertaken_drivers AS (\n  -- For each overtake event step, identify the overtaken driver as the one who held that position on the previous lap\n  SELECT\n    e.race_id,\n    e.overtaking_driver_id,\n    e.lap,\n    lp_prev_other.driver_id AS overtaken_driver_id\n  FROM overtake_events AS e\n  INNER JOIN overtakes AS o\n    ON o.race_id = e.race_id\n   AND o.overtaking_driver_id = e.overtaking_driver_id\n   AND o.lap = e.lap\n  INNER JOIN lap_positions AS lp_prev_other\n    ON lp_prev_other.race_id = e.race_id\n   AND lp_prev_other.lap = e.lap - 1\n   AND lp_prev_other.position = (o.prev_position - e.step + 1)\n),\nclassified AS (\n  SELECT\n    od.race_id,\n    od.overtaking_driver_id,\n    od.overtaken_driver_id,\n    od.lap,\n    CASE\n      WHEN r.driver_id IS NOT NULL THEN 'R'                 -- retirement on same lap\n      WHEN ps_same.driver_id IS NOT NULL\n        OR ps_prev.driver_id IS NOT NULL THEN 'P'           -- pit on same lap or previous lap\n      WHEN od.lap = 1\n       AND ABS(res_overtaker.grid - res_overtaken.grid) <= 2 THEN 'S'  -- start-related\n      ELSE 'T'                                              -- normal track pass\n    END AS category\n  FROM overtaken_drivers AS od\n  LEFT JOIN retirements AS r\n    ON r.race_id = od.race_id\n   AND r.driver_id = od.overtaken_driver_id\n   AND r.lap = od.lap\n  LEFT JOIN pit_stops AS ps_same\n    ON ps_same.race_id = od.race_id\n   AND ps_same.driver_id = od.overtaken_driver_id\n   AND ps_same.lap = od.lap\n  LEFT JOIN pit_stops AS ps_prev\n    ON ps_prev.race_id = od.race_id\n   AND ps_prev.driver_id = od.overtaken_driver_id\n   AND ps_prev.lap = od.lap - 1\n  LEFT JOIN results AS res_overtaker\n    ON res_overtaker.race_id = od.race_id\n   AND res_overtaker.driver_id = od.overtaking_driver_id\n  LEFT JOIN results AS res_overtaken\n    ON res_overtaken.race_id = od.race_id\n   AND res_overtaken.driver_id = od.overtaken_driver_id\n)\nSELECT\n  SUM(CASE WHEN category = 'R' THEN 1 ELSE 0 END) AS retirements,\n  SUM(CASE WHEN category = 'P' THEN 1 ELSE 0 END) AS pit_stops,\n  SUM(CASE WHEN category = 'S' THEN 1 ELSE 0 END) AS start_related_overtakes,\n  SUM(CASE WHEN category = 'T' THEN 1 ELSE 0 END) AS standard_on_track_passes\nFROM classified;\t----- bird -----\tf1_spider2",
    "128": "WITH season_constructor_points AS (\n  SELECT\n    r.year AS season_year,\n    c.constructor_id,\n    c.name AS constructor_name,\n    SUM(res.points) AS constructor_points\n  FROM results AS res\n  INNER JOIN races AS r\n    ON res.race_id = r.race_id\n  INNER JOIN constructors AS c\n    ON res.constructor_id = c.constructor_id\n  WHERE r.year >= 2001\n  GROUP BY\n    r.year, c.constructor_id, c.name\n),\nmin_points_per_season AS (\n  SELECT\n    season_year,\n    MIN(constructor_points) AS min_constructor_points\n  FROM season_constructor_points\n  WHERE constructor_points > 0\n  GROUP BY season_year\n),\nconstructors_with_min AS (\n  SELECT\n    scp.constructor_name,\n    scp.season_year\n  FROM season_constructor_points AS scp\n  INNER JOIN min_points_per_season AS mps\n    ON scp.season_year = mps.season_year\n   AND scp.constructor_points = mps.min_constructor_points\n)\nSELECT\n  constructor_name\nFROM constructors_with_min\nGROUP BY constructor_name\nORDER BY COUNT(DISTINCT season_year) DESC\nLIMIT 5;\t----- bird -----\tf1_spider2",
    "129": "WITH ranked AS (\n  SELECT\n    r.year,\n    de.full_name AS driver_full_name,\n    ce.name AS constructor_name,\n    SUM(res.points) AS total_points,\n    ROW_NUMBER() OVER (\n      PARTITION BY r.year\n      ORDER BY SUM(res.points) DESC\n    ) AS rn\n  FROM results AS res\n  INNER JOIN races AS r\n    ON res.race_id = r.race_id\n  INNER JOIN drivers_ext AS de\n    ON res.driver_id = de.driver_id\n  INNER JOIN constructors_ext AS ce\n    ON res.constructor_id = ce.constructor_id\n  GROUP BY\n    r.year,\n    de.full_name,\n    ce.name\n)\nSELECT\n  year,\n  driver_full_name,\n  constructor_name\nFROM ranked\nWHERE rn = 1\nORDER BY year;\t----- bird -----\tf1_spider2",
    "130": "WITH driver_year_points AS (\n  SELECT\n    r.year AS year,\n    re.driver_id AS driver_id,\n    SUM(re.points) AS driver_points\n  FROM results AS re\n  INNER JOIN races AS r\n    ON re.race_id = r.race_id\n  GROUP BY\n    r.year,\n    re.driver_id\n),\nmax_driver_by_year AS (\n  SELECT\n    year,\n    MAX(driver_points) AS max_driver_points\n  FROM driver_year_points\n  GROUP BY year\n),\nconstructor_year_points AS (\n  SELECT\n    r.year AS year,\n    re.constructor_id AS constructor_id,\n    SUM(re.points) AS constructor_points\n  FROM results AS re\n  INNER JOIN races AS r\n    ON re.race_id = r.race_id\n  GROUP BY\n    r.year,\n    re.constructor_id\n),\nmax_constructor_by_year AS (\n  SELECT\n    year,\n    MAX(constructor_points) AS max_constructor_points\n  FROM constructor_year_points\n  GROUP BY year\n)\nSELECT\n  d.year\nFROM max_driver_by_year AS d\nINNER JOIN max_constructor_by_year AS c\n  ON d.year = c.year\nORDER BY\n  (d.max_driver_points + c.max_constructor_points) ASC,\n  d.year ASC\nLIMIT 3;\t----- bird -----\tf1_spider2",
    "131": "SELECT\n  c.name AS constructor_name,\n  r.year,\n  SUM(res.points) AS total_points\nFROM results AS res\nINNER JOIN constructors AS c\n  ON res.constructor_id = c.constructor_id\nINNER JOIN races AS r\n  ON res.race_id = r.race_id\nGROUP BY\n  c.name,\n  r.year\nORDER BY\n  total_points DESC\nLIMIT 3;\t----- bird -----\tf1_spider2",
    "132": "SELECT\n  d.forename,\n  d.surname\nFROM drives AS dv\nINNER JOIN drivers AS d\n  ON d.driver_id = dv.driver_id\nINNER JOIN races AS r\n  ON r.year = dv.year\nWHERE r.year >= 1950\n  AND r.year < 1960\nGROUP BY\n  dv.driver_id\nHAVING COUNT(DISTINCT r.round) >= 2\n   AND dv.first_round = dv.last_round;\t----- bird -----\tf1_spider2",
    "133": "WITH driver_year_rounds AS (\n  SELECT\n    r.year,\n    r.round,\n    res.driver_id,\n    res.constructor_id\n  FROM results AS res\n  INNER JOIN races AS r\n    ON r.race_id = res.race_id\n  WHERE res.driver_id IS NOT NULL\n),\neligible_driver_year AS (\n  SELECT\n    year,\n    driver_id\n  FROM driver_year_rounds\n  GROUP BY year, driver_id\n  HAVING COUNT(*) < 3\n),\neligible_rows AS (\n  SELECT dyr.*\n  FROM driver_year_rounds AS dyr\n  INNER JOIN eligible_driver_year AS edy\n    ON edy.year = dyr.year\n   AND edy.driver_id = dyr.driver_id\n),\nswitchers AS (\n  SELECT\n    year,\n    driver_id\n  FROM (\n    SELECT\n      year,\n      driver_id,\n      constructor_id,\n      LAG(constructor_id) OVER (\n        PARTITION BY year, driver_id\n        ORDER BY round\n      ) AS prev_constructor_id\n    FROM eligible_rows\n  )\n  WHERE prev_constructor_id IS NOT NULL\n    AND constructor_id <> prev_constructor_id\n  GROUP BY year, driver_id\n),\nfinal_driver_year AS (\n  SELECT er.*\n  FROM eligible_rows AS er\n  INNER JOIN switchers AS s\n    ON s.year = er.year\n   AND s.driver_id = er.driver_id\n),\nyear_minmax AS (\n  SELECT\n    year,\n    MIN(round) AS first_round,\n    MAX(round) AS last_round\n  FROM final_driver_year\n  GROUP BY year\n)\nSELECT\n  AVG(first_round) AS overall_avg_first_round,\n  AVG(last_round)  AS overall_avg_last_round\nFROM year_minmax;\t----- bird -----\tf1_spider2",
    "134": "WITH race_laps AS (\n  SELECT\n    lp.race_id,\n    lp.driver_id,\n    lp.lap,\n    lp.position,\n    LAG(lp.position) OVER (\n      PARTITION BY lp.race_id, lp.driver_id\n      ORDER BY lp.lap\n    ) AS prev_position\n  FROM lap_positions AS lp\n  WHERE lp.lap_type = 'R'\n),\nvalid_laps AS (\n  SELECT rl.*\n  FROM race_laps AS rl\n  LEFT JOIN pit_stops AS ps\n    ON ps.race_id = rl.race_id\n   AND ps.driver_id = rl.driver_id\n   AND ps.lap = rl.lap\n  LEFT JOIN retirements AS rt\n    ON rt.race_id = rl.race_id\n   AND rt.driver_id = rl.driver_id\n   AND rt.lap = rl.lap\n  WHERE ps.lap IS NULL\n    AND rt.lap IS NULL\n    AND rl.lap <> 1\n    AND rl.prev_position IS NOT NULL\n),\nlap_deltas AS (\n  SELECT\n    race_id,\n    lap,\n    driver_id,\n    (prev_position - position) AS delta\n  FROM valid_laps\n),\novertake_counts AS (\n  SELECT\n    driver_id,\n    SUM(CASE WHEN delta < 0 THEN -delta ELSE 0 END) AS overtaken,\n    SUM(CASE WHEN delta > 0 THEN  delta ELSE 0 END) AS overtakes\n  FROM lap_deltas\n  GROUP BY driver_id\n)\nSELECT de.full_name\nFROM overtake_counts AS oc\nINNER JOIN drivers_ext AS de\n  ON de.driver_id = oc.driver_id\nWHERE oc.overtaken > oc.overtakes;\t----- bird -----\tf1_spider2"
}